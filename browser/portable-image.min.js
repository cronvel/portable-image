(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.PortableImage=e()}})(function(){var e,t,r;return function(){function l(o,a,s){function f(r,e){if(!a[r]){if(!o[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(h)return h(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[r]={exports:{}};o[r][0].call(i.exports,function(e){var t=o[r][1][e];return f(t||e)},i,i.exports,l,o,a,s)}return a[r].exports}for(var h="function"==typeof require&&require,e=0;e<s.length;e++)f(s[e]);return f}return l}()({1:[function(e,t,r){"use strict";function n(e={}){this.imageIndex=+e.imageIndex||0;this.x=+e.x||0;this.y=+e.y||0}t.exports=n},{}],2:[function(e,t,r){"use strict";function s(e={}){this.channels=Array.isArray(e.channels)?e.channels:s.RGBA;this.indexed=e.indexed||Array.isArray(e.palette);this.bytesPerPixel=this.indexed?1:this.channels.length;this.palette=this.indexed?[]:null;if(Array.isArray(e.palette)){this.setPalette(e.palette)}this.channelIndex={};for(let e=0;e<this.channels.length;e++){this.channelIndex[this.channels[e]]=e}this.isRgbCompatible=this.channels.length>=3&&this.channels[0]==="red"&&this.channels[1]==="green"&&this.channels[2]==="blue";this.isRgbaCompatible=this.channels.length>=4&&this.isRgbCompatible&&this.channels[3]==="alpha";this.isRgb=this.isRgbCompatible&&this.channels.length===3;this.isRgba=this.isRgbaCompatible&&this.channels.length===4;this.isGrayCompatible=this.channels.length>=1&&this.channels[0]==="gray";this.isGrayAlphaCompatible=this.channels.length>=2&&this.isGrayCompatible&&this.channels[1]==="alpha";this.isGray=this.isGrayCompatible&&this.channels.length===1;this.isGrayAlpha=this.isGrayAlphaCompatible&&this.channels.length===2}t.exports=s;const n=s.Mapping=e("./Mapping.js");s.Mapping=n;s.DirectChannelMapping=n.DirectChannelMapping;s.DirectChannelMappingWithDefault=n.DirectChannelMappingWithDefault;s.MatrixChannelMapping=n.MatrixChannelMapping;s.compositing=e("./compositing.js");s.RGB=["red","green","blue"];s.RGBA=["red","green","blue","alpha"];s.GRAY=["gray"];s.GRAY_ALPHA=["gray","alpha"];s.prototype.setPalette=function(t){if(!this.indexed){throw new Error("This is not an indexed image")}this.palette.length=0;for(let e=0;e<t.length;e++){this.setPaletteEntry(e,t[e])}};s.prototype.setPaletteEntry=function(e,t){if(this.isRgb||this.isRgba){return this.setPaletteColor(e,t)}if(!this.indexed){throw new Error("This is not an indexed image")}if(!t){return}var r=this.palette[e];if(!r){r=this.palette[e]=[]}if(Array.isArray(t)){for(let e=0;e<this.channels.length;e++){r[e]=t[e]??0}}else if(typeof t==="object"){for(let e=0;e<this.channels.length;e++){r[e]=t[this.channels[e]]??0}}};const i=255;s.prototype.setPaletteColor=function(e,t){if(!this.indexed){throw new Error("This is not an indexed image")}if(!t){return}var r=this.palette[e];if(!r){r=this.palette[e]=[]}if(Array.isArray(t)){r[0]=t[0]??0;r[1]=t[1]??0;r[2]=t[2]??0;if(this.isRgba){r[3]=t[3]??255}}else if(typeof t==="object"){r[0]=t.R??t.r??0;r[1]=t.G??t.g??0;r[2]=t.B??t.b??0;if(this.isRgba){r[3]=t.A??t.a??255}}else if(typeof t==="string"&&t[0]==="#"){t=t.slice(1);if(t.length===3){t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}let e=Number.parseInt(t,16);if(t.length===6){r[0]=e>>16&i;r[1]=e>>8&i;r[2]=e&i;if(this.isRgba){r[3]=255}}else if(t.length===8){r[0]=e>>24&i;r[1]=e>>16&i;r[2]=e>>8&i;if(this.isRgba){r[3]=e&i}}}};s.prototype.hasSamePalette=function(n){if(!this.palette||!n.palette){return false}if(this.palette.length!==n.palette.length){return false}for(let r=0;r<this.palette.length;r++){let t=this.palette[r];for(let e=0;e<t.length;e++){if(t[e]!==n.palette[r][e]){return false}}}return true};s.DEFAULT_CHANNEL_VALUES={red:0,green:0,blue:0,alpha:255};s.prototype.getAutoMappingToChannels=function(r,n=s.DEFAULT_CHANNEL_VALUES){var i=new Array(r.length*2);for(let t=0;t<r.length;t++){let e=r[t];if(Object.hasOwn(this.channelIndex,e)){i[t*2]=this.channelIndex[e];i[t*2+1]=null}else{i[t*2]=null;i[t*2+1]=n[e]??0}}return new s.DirectChannelMappingWithDefault(i)};s.getAutoMapping=function(n,i,o=s.DEFAULT_CHANNEL_VALUES){var a=new Array(i.length*2);for(let r=0;r<i.length;r++){let e=i[r];let t=n.indexOf(e);if(t>=0){a[r*2]=t;a[r*2+1]=null}else{a[r*2]=null;a[r*2+1]=o[e]??0}}return new s.DirectChannelMappingWithDefault(a)};s.prototype.getClosestPaletteIndex=i=>{var e=Math.min(this.channels.length,i.length),o=Infinity,a=0;for(let n=0;n<this.palette.length;n++){let r=0;for(let t=0;t<e;t++){let e=this.palette[n][t]-i[t];r+=e*e;if(r<o){o=r;a=n}}}return a}},{"./Mapping.js":6,"./compositing.js":8}],3:[function(e,t,r){"use strict";function n(e,t={}){Object.defineProperty(this,"sprite",{value:e});this.duration=t.duration;this.cells=[]}t.exports=n;const i=e("./Sprite.js");const o=e("./Layer.js");const a=e("./Image.js");n.prototype.addCell=function(e){this.cells.push(e);return this.cells.length-1};n.prototype.toImage=function(e=a){var r=new a({width:this.sprite.width,height:this.sprite.height,channelDef:this.sprite.channelDef});for(let t of this.cells){let e=this.sprite.images[t.imageIndex];e.copyTo(r,{compositing:a.compositing.binaryOver,x:t.x,y:t.y});console.log("Copy from/to:",r,e," --- cell: ",t)}return r}},{"./Image.js":4,"./Layer.js":5,"./Sprite.js":7}],4:[function(e,r,t){(function(t){(function(){"use strict";function s(e={}){this.width=e.width;this.height=e.height;this.channelDef=e.channelDef??new f(e);this.pixelBuffer=null;if(e.pixelBuffer){if(e.pixelBuffer instanceof t){if(e.pixelBuffer.length!==this.width*this.height*this.channelDef.bytesPerPixel){throw new Error("Provided pixel Buffer mismatch the expected size (should be exactly width * height * bytesPerPixel)")}this.pixelBuffer=e.pixelBuffer}else if(e.pixelBuffer instanceof Uint8Array){if(e.pixelBuffer.length!==this.width*this.height*this.channelDef.bytesPerPixel){throw new Error("Provided pixel Uint8Array buffer mismatch the expected size (should be exactly width * height * bytesPerPixel)")}this.pixelBuffer=t.from(e.pixelBuffer)}else{throw new Error("Provided pixel buffer is not a Buffer or a Uint8Array")}}else{this.pixelBuffer=t.allocUnsafe(this.width*this.height*this.channelDef.bytesPerPixel)}}r.exports=s;const f=s.ChannelDef=s.prototype.ChannelDef=e("./ChannelDef.js");s.compositing=e("./compositing.js");s.prototype.setPalette=function(e){this.channelDef.setPalette(e)};s.prototype.setPaletteEntry=function(e,t){this.channelDef.setPaletteEntry(e,t)};s.prototype.setPaletteColor=function(e,t){this.channelDef.setPaletteColor(e,t)};s.prototype.hasSamePalette=function(e){return this.channelDef.hasSamePalette(e.channelDef)};s.prototype.getAutoMappingTo=function(e,t=f.DEFAULT_CHANNEL_VALUES){return this.channelDef.getAutoMappingToChannels(e.channelDef.channels,t)};s.prototype.copyTo=function(e,t={}){var r=t.mapping,n=t.scaleX??t.scale??1,i=t.scaleY??t.scale??1;if(!r){r=this.getAutoMappingTo(e)}let o={buffer:this.pixelBuffer,width:this.width,height:this.height,bytesPerPixel:this.channelDef.bytesPerPixel,x:t.x<0?-t.x/n:0,y:t.y<0?-t.y/i:0,endX:this.width,endY:this.height,channels:this.channelDef.channels.length,scaleX:n,scaleY:i,mapping:r,compositing:t.compositing||null};let a={buffer:e.pixelBuffer,width:e.width,height:e.height,bytesPerPixel:e.channelDef.bytesPerPixel,x:t.x>0?t.x:0,y:t.y>0?t.y:0,endX:e.width,endY:e.height,channels:e.channelDef.channels.length};if(o.compositing){if(this.channelDef.indexed){if(e.channelDef.indexed){if(!this.hasSamePalette(e)){throw new Error("Uncompatible palettes are not supported yet")}o.palette=this.channelDef.palette;if(o.compositing.id==="binaryOver"&&this.channelDef.channelIndex.alpha!==undefined){o.alphaChannel=this.channelDef.channelIndex.alpha;s.fullIndexedBlitWithTransparency(o,a)}else{throw new Error("Copy indexed to indexed with compositing is not supported yet, except for 'binaryOver' mode")}}else{o.palette=this.channelDef.palette;s.compositingBlitFromIndexed(o,a)}}else{if(e.channelDef.indexed){throw new Error("Copy to indexed portable image is not supported yet")}s.compositingBlit(o,a)}}else{if(this.channelDef.indexed){if(e.channelDef.indexed){if(!this.hasSamePalette(e)){throw new Error("Uncompatible palettes are not supported yet")}o.mapping=f.Mapping.INDEXED_TO_INDEXED;s.blit(o,a)}else{o.palette=this.channelDef.palette;s.blitFromIndexed(o,a)}}else{if(e.channelDef.indexed){throw new Error("Copy to indexed portable image is not supported yet")}s.blit(o,a)}}};s.prototype.createImageData=function(e={}){var t=e.scaleX??e.scale??1,r=e.scaleY??e.scale??1;var n=new ImageData(this.width*t,this.height*r);this.updateImageData(n,e);return n};s.prototype.updateImageData=function(e,t={}){var r=t.mapping,n=t.scaleX??t.scale??1,i=t.scaleY??t.scale??1;if(!r){if(e.width===this.width&&e.height===this.height){if(this.channelDef.indexed){if(this.channelDef.isRgbaCompatible){return this.isoIndexedRgbaCompatibleToRgbaBlit(e.data)}if(this.channelDef.isRgbCompatible){return this.isoIndexedRgbCompatibleToRgbaBlit(e.data)}}else{if(this.channelDef.isRgbaCompatible){return this.isoRgbaCompatibleToRgbaBlit(e.data)}if(this.channelDef.isRgbCompatible){return this.isoRgbCompatibleToRgbaBlit(e.data)}}}if(this.channelDef.isRgbaCompatible){r=f.Mapping.RGBA_COMPATIBLE_TO_RGBA}else if(this.channelDef.isRgbCompatible){r=f.Mapping.RGB_COMPATIBLE_TO_RGBA}else if(this.channelDef.isGrayAlphaCompatible){r=f.Mapping.GRAY_ALPHA_COMPATIBLE_TO_RGBA}else if(this.channelDef.isGrayCompatible){r=f.Mapping.GRAY_COMPATIBLE_TO_RGBA}else{throw new Error("Mapping required for image that are not RGB/RGBA/Grayscale/Grayscale+Alpha compatible")}}let o={buffer:this.pixelBuffer,width:this.width,height:this.height,bytesPerPixel:this.channelDef.bytesPerPixel,x:t.x<0?-t.x/n:0,y:t.y<0?-t.y/i:0,endX:this.width,endY:this.height,channels:this.channelDef.channels.length,scaleX:n,scaleY:i,mapping:r,compositing:t.compositing||null};let a={buffer:e.data,width:e.width,height:e.height,bytesPerPixel:4,x:t.x>0?t.x:0,y:t.y>0?t.y:0,endX:e.width,endY:e.height,channels:4};if(o.compositing){if(this.channelDef.indexed){o.palette=this.channelDef.palette;s.compositingBlitFromIndexed(o,a)}else{s.compositingBlit(o,a)}}else{if(this.channelDef.indexed){o.palette=this.channelDef.palette;s.blitFromIndexed(o,a)}else{s.blit(o,a)}}};s.blit=function(i,o){var e=Math.min(o.endX-o.x,(i.endX-i.x)*i.scaleX),t=Math.min(o.endY-o.y,(i.endY-i.y)*i.scaleY);for(let n=0;n<t;n++){for(let r=0;r<e;r++){let e=((o.y+n)*o.width+(o.x+r))*o.bytesPerPixel;let t=(Math.floor(i.y+n/i.scaleY)*i.width+Math.floor(i.x+r/i.scaleX))*i.bytesPerPixel;i.mapping.map(i,o,t,e)}}};s.blitFromIndexed=function(o,a){console.warn(".blitFromIndexed() used",o,a);var e=Math.min(a.endX-a.x,(o.endX-o.x)*o.scaleX),t=Math.min(a.endY-a.y,(o.endY-o.y)*o.scaleY);for(let i=0;i<t;i++){for(let n=0;n<e;n++){let e=((a.y+i)*a.width+(a.x+n))*a.bytesPerPixel;let t=(Math.floor(o.y+i/o.scaleY)*o.width+Math.floor(o.x+n/o.scaleX))*o.bytesPerPixel;let r=o.palette[o.buffer[t]];o.mapping.map(o,a,0,e,r)}}};s.compositingBlit=function(i,o){var e=Math.min(o.endX-o.x,(i.endX-i.x)*i.scaleX),t=Math.min(o.endY-o.y,(i.endY-i.y)*i.scaleY);for(let n=0;n<t;n++){for(let r=0;r<e;r++){let e=((o.y+n)*o.width+(o.x+r))*o.bytesPerPixel;let t=(Math.floor(i.y+n/i.scaleY)*i.width+Math.floor(i.x+r/i.scaleX))*i.bytesPerPixel;i.mapping.compose(i,o,t,e,i.compositing)}}};s.compositingBlitFromIndexed=function(o,a){var e=Math.min(a.endX-a.x,(o.endX-o.x)*o.scaleX),t=Math.min(a.endY-a.y,(o.endY-o.y)*o.scaleY);for(let i=0;i<t;i++){for(let n=0;n<e;n++){let e=((a.y+i)*a.width+(a.x+n))*a.bytesPerPixel;let t=(Math.floor(o.y+i/o.scaleY)*o.width+Math.floor(o.x+n/o.scaleX))*o.bytesPerPixel;let r=o.palette[o.buffer[t]];o.mapping.compose(o,a,0,e,o.compositing,r)}}};s.fullIndexedBlitWithTransparency=function(i,o){console.warn(".fullIndexedBlitWithTransparency() used",i,o);var e=Math.min(o.endX-o.x,(i.endX-i.x)*i.scaleX),t=Math.min(o.endY-o.y,(i.endY-i.y)*i.scaleY);for(let n=0;n<t;n++){for(let r=0;r<e;r++){let e=((o.y+n)*o.width+(o.x+r))*o.bytesPerPixel;let t=(Math.floor(i.y+n/i.scaleY)*i.width+Math.floor(i.x+r/i.scaleX))*i.bytesPerPixel;if(i.palette[i.buffer[t]][i.alphaChannel]){o.buffer[e]=i.buffer[t]}}}};s.prototype.isoRgbCompatibleToRgbaBlit=function(n){for(let r=0,e=this.width*this.height;r<e;r++){let e=r*this.channelDef.bytesPerPixel;let t=r*4;n[t]=this.pixelBuffer[e];n[t+1]=this.pixelBuffer[e+1];n[t+2]=this.pixelBuffer[e+2];n[t+3]=255}};s.prototype.isoRgbaCompatibleToRgbaBlit=function(n){for(let r=0,e=this.width*this.height;r<e;r++){let e=r*this.channelDef.bytesPerPixel;let t=r*4;n[t]=this.pixelBuffer[e];n[t+1]=this.pixelBuffer[e+1];n[t+2]=this.pixelBuffer[e+2];n[t+3]=this.pixelBuffer[e+3]}};s.prototype.isoIndexedRgbCompatibleToRgbaBlit=function(i){for(let n=0,e=this.width*this.height;n<e;n++){let e=n*this.channelDef.bytesPerPixel;let t=n*4;let r=this.channelDef.palette[this.pixelBuffer[e]];i[t]=r[0];i[t+1]=r[1];i[t+2]=r[2];i[t+3]=255}};s.prototype.isoIndexedRgbaCompatibleToRgbaBlit=function(i){for(let n=0,e=this.width*this.height;n<e;n++){let e=n*this.channelDef.bytesPerPixel;let t=n*4;let r=this.channelDef.palette[this.pixelBuffer[e]];i[t]=r[0];i[t+1]=r[1];i[t+2]=r[2];i[t+3]=r[3]}};s.prototype.updateFromImageData=function(e,t){throw new Error("Not coded!")}}).call(this)}).call(this,e("buffer").Buffer)},{"./ChannelDef.js":2,"./compositing.js":8,buffer:11}],5:[function(e,t,r){"use strict";function n(e,t={}){this.name=e||"";this.visible=t.visible??true;this.compositing=t.compositing??null;this.opacity=t.opacity??1;this.order=t.order??0}t.exports=n},{}],6:[function(e,t,r){"use strict";function n(e,t){this.matrix=e;this.alphaChannelDst=t??null;this.composeChannelOrder=null;if(this.alphaChannelDst===null){this.compose=this.map}else{this.composeChannelOrder=[this.alphaChannelDst];for(let e=0;e<this.dstChannels;e++){if(e!==this.alphaChannelDst){this.composeChannelOrder.push(e)}}}}n.prototype.map=function(){};n.prototype.compose=function(){};t.exports=n;function s(e){return Math.max(0,Math.min(255,Math.round(e)))}function l(e){return Math.max(0,Math.min(255,Math.round(255*e)))}function u(e){return Math.max(0,Math.min(1,e/255))}const p={alpha:e=>e,channel:(e,t,r)=>r};function i(e,t){this.dstChannels=e.length;n.call(this,e,t)}i.prototype=Object.create(n.prototype);i.prototype.constructor=i;n.DirectChannelMapping=i;i.prototype.map=function(e,t,r,n,i=e.buffer){for(let e=0;e<t.channels;e++){t.buffer[n+e]=i[r+this.matrix[e]]}};i.prototype.compose=function(e,t,r,n,i=p,o=e.buffer){let a=t.buffer[n+this.alphaChannelDst]/255;let s=1;for(let e of this.composeChannelOrder){if(e===this.alphaChannelDst){s=o[r+this.matrix[e]]/255;t.buffer[n+e]=l(i.alpha(s,a))}else{t.buffer[n+e]=l(i.channel(s,a,o[r+this.matrix[e]]/255,t.buffer[n+e]/255))}}};function o(e,t){this.dstChannels=Math.floor(e.length/2);n.call(this,e,t)}o.prototype=Object.create(n.prototype);o.prototype.constructor=o;n.DirectChannelMappingWithDefault=o;o.prototype.map=function(e,t,r,n,i=e.buffer){for(let e=0;e<t.channels;e++){t.buffer[n+e]=this.matrix[e*2+1]??i[r+this.matrix[e*2]]}};o.prototype.compose=function(e,t,r,n,i=p,o=e.buffer){let a=t.buffer[n+this.alphaChannelDst]/255;let s=1;for(let e of this.composeChannelOrder){if(e===this.alphaChannelDst){s=(this.matrix[e*2+1]??o[r+this.matrix[e*2]])/255;t.buffer[n+e]=l(i.alpha(s,a))}else{t.buffer[n+e]=l(i.channel(s,a,(this.matrix[e*2+1]??o[r+this.matrix[e*2]])/255,t.buffer[n+e]/255))}}};function a(e,t,r){this.dstChannels=Math.floor(e.length/(t+1));this.srcChannelsUsed=t;n.call(this,e,r)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;n.MatrixChannelMapping=a;a.prototype.map=function(e,r,n,i,o=e.buffer){let a=0;for(let e=0;e<r.channels;e++){let t=0;for(let e=0;e<this.srcChannelsUsed;e++){t+=o[n+e]*this.matrix[a++]}t+=this.matrix[a++];r.buffer[i+e]=s(t)}};a.prototype.compose=function(e,n,i,o,a=p,s=e.buffer){let f=n.buffer[o+this.alphaChannelDst]/255;let h=1;for(let e of this.composeChannelOrder){let t=e*(this.srcChannelsUsed+1);let r=0;for(let e=0;e<this.srcChannelsUsed;e++){r+=s[i+e]*this.matrix[t++]}r+=this.matrix[t++];r=u(r);if(e===this.alphaChannelDst){n.buffer[o+e]=l(a.alpha(r,f))}else{n.buffer[o+e]=l(a.channel(h,f,r,n.buffer[o+e]/255))}}};n.INDEXED_TO_INDEXED=new i([0]);n.RGBA_COMPATIBLE_TO_RGBA=new i([0,1,2,3],3);n.RGB_COMPATIBLE_TO_RGBA=new o([0,null,1,null,2,null,null,255],3);n.GRAY_ALPHA_COMPATIBLE_TO_RGBA=new i([0,0,0,1],3);n.GRAY_COMPATIBLE_TO_RGBA=new o([0,null,0,null,0,null,null,255],3);n.RGBA_COMPATIBLE_TO_GRAY_ALPHA=new a([1/3,1/3,1/3,0,0,0,0,0,1,0],4,1);n.RGB_COMPATIBLE_TO_GRAY_ALPHA=new a([1/3,1/3,1/3,0,0,0,0,255],3,1)},{}],7:[function(e,t,r){"use strict";function n(e={}){this.width=e.width;this.height=e.height;this.channelDef=e.channelDef??new i(e);this.images=[];this.layers=[];this.frames=[];this.animations=[];this.orderedLayers=[];this.animationByName=new Map}t.exports=n;const i=n.ChannelDef=n.prototype.ChannelDef=e("./ChannelDef.js");const o=n.Image=n.prototype.Image=e("./Image.js");const a=n.Frame=n.prototype.Frame=e("./Frame.js");const s=n.Layer=n.prototype.Layer=e("./Layer.js");const f=n.Cell=n.prototype.Cell=e("./Cell.js");n.prototype.addImage=function(e){this.images.push(e);return this.images.length-1};n.prototype.addFrame=function(e){if(!(e instanceof a)){e=new a(this,e)}this.frames.push(e)};n.prototype.toImage=function(e){return this.frames[0].toImage(e)}},{"./Cell.js":1,"./ChannelDef.js":2,"./Frame.js":3,"./Image.js":4,"./Layer.js":5}],8:[function(e,t,r){"use strict";const i={};t.exports=i;i.normal=i.over={id:"over",alpha:(e,t)=>e+t*(1-e),channel:(e,t,r,n)=>(r*e+n*t*(1-e))/(e+t*(1-e))||0};i.binaryOver={id:"binaryOver",alpha:(e,t)=>e?1:t,channel:(e,t,r,n)=>e?r:n};i.in={id:"in",alpha:(e,t)=>e*t,channel:i.normal.channel};i.out={id:"out",alpha:(e,t)=>e*(1-t),channel:(e,t,r,n)=>(r*e+n*(1-t)*(1-e))/(e+(1-t)*(1-e))||0};i.atop={id:"atop",alpha:(e,t)=>i.normal.alpha(e,t)*t,channel:i.normal.channel};i.xor={id:"xor",alpha:(e,t)=>e*(1-t)+t*(1-e),channel:i.normal.channel};i.multiply={id:"multiply",alpha:i.normal.alpha,channel:(e,t,r,n)=>i.normal.channel(e,t,r*(1+(n-1)*t),n)};i.screen={id:"screen",alpha:i.normal.alpha,channel:(e,t,r,n)=>i.normal.channel(e,t,1-(1-r)*(1-n*t),n)};i.overlay={id:"overlay",alpha:i.normal.alpha,channel:(e,t,r,n)=>i.normal.channel(e,t,1+(n-1)*t<.5?2*r*(1+(n-1)*t):n*t>.5?1-2*(1-r)*(1-n*t):r,n)}},{}],9:[function(e,t,r){"use strict";const n={};t.exports=n;n.Image=e("./Image.js");n.Sprite=e("./Sprite.js");n.Mapping=e("./Mapping.js");n.compositing=e("./compositing.js")},{"./Image.js":4,"./Mapping.js":6,"./Sprite.js":7,"./compositing.js":8}],10:[function(e,t,r){"use strict";r.byteLength=a;r.toByteArray=s;r.fromByteArray=y;var f=[];var h=[];var l=typeof Uint8Array!=="undefined"?Uint8Array:Array;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,o=n.length;i<o;++i){f[i]=n[i];h[n.charCodeAt(i)]=i}h["-".charCodeAt(0)]=62;h["_".charCodeAt(0)]=63;function u(e){var t=e.length;if(t%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var r=e.indexOf("=");if(r===-1)r=t;var n=r===t?0:4-r%4;return[r,n]}function a(e){var t=u(e);var r=t[0];var n=t[1];return(r+n)*3/4-n}function p(e,t,r){return(t+r)*3/4-r}function s(e){var t;var r=u(e);var n=r[0];var i=r[1];var o=new l(p(e,n,i));var a=0;var s=i>0?n-4:n;var f;for(f=0;f<s;f+=4){t=h[e.charCodeAt(f)]<<18|h[e.charCodeAt(f+1)]<<12|h[e.charCodeAt(f+2)]<<6|h[e.charCodeAt(f+3)];o[a++]=t>>16&255;o[a++]=t>>8&255;o[a++]=t&255}if(i===2){t=h[e.charCodeAt(f)]<<2|h[e.charCodeAt(f+1)]>>4;o[a++]=t&255}if(i===1){t=h[e.charCodeAt(f)]<<10|h[e.charCodeAt(f+1)]<<4|h[e.charCodeAt(f+2)]>>2;o[a++]=t>>8&255;o[a++]=t&255}return o}function c(e){return f[e>>18&63]+f[e>>12&63]+f[e>>6&63]+f[e&63]}function g(e,t,r){var n;var i=[];for(var o=t;o<r;o+=3){n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(e[o+2]&255);i.push(c(n))}return i.join("")}function y(e){var t;var r=e.length;var n=r%3;var i=[];var o=16383;for(var a=0,s=r-n;a<s;a+=o){i.push(g(e,a,a+o>s?s:a+o))}if(n===1){t=e[r-1];i.push(f[t>>2]+f[t<<4&63]+"==")}else if(n===2){t=(e[r-2]<<8)+e[r-1];i.push(f[t>>10]+f[t>>4&63]+f[t<<2&63]+"=")}return i.join("")}},{}],11:[function(Z,e,K){(function(e){(function(){"use strict";var n=Z("base64-js");var o=Z("ieee754");K.Buffer=p;K.SlowBuffer=t;K.INSPECT_MAX_BYTES=50;var r=2147483647;K.kMaxLength=r;p.TYPED_ARRAY_SUPPORT=e();if(!p.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function e(){try{var e=new Uint8Array(1);e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return e.foo()===42}catch(e){return false}}Object.defineProperty(p.prototype,"parent",{enumerable:true,get:function(){if(!p.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(p.prototype,"offset",{enumerable:true,get:function(){if(!p.isBuffer(this))return undefined;return this.byteOffset}});function a(e){if(e>r){throw new RangeError('The value "'+e+'" is invalid for option "size"')}var t=new Uint8Array(e);t.__proto__=p.prototype;return t}function p(e,t,r){if(typeof e==="number"){if(typeof t==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return h(e)}return i(e,t,r)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&p[Symbol.species]===p){Object.defineProperty(p,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}p.poolSize=8192;function i(e,t,r){if(typeof e==="string"){return l(e,t)}if(ArrayBuffer.isView(e)){return u(e)}if(e==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof e)}if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer)){return c(e,t,r)}if(typeof e==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var n=e.valueOf&&e.valueOf();if(n!=null&&n!==e){return p.from(n,t,r)}var i=g(e);if(i)return i;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof e[Symbol.toPrimitive]==="function"){return p.from(e[Symbol.toPrimitive]("string"),t,r)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof e)}p.from=function(e,t,r){return i(e,t,r)};p.prototype.__proto__=Uint8Array.prototype;p.__proto__=Uint8Array;function s(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be of type number')}else if(e<0){throw new RangeError('The value "'+e+'" is invalid for option "size"')}}function f(e,t,r){s(e);if(e<=0){return a(e)}if(t!==undefined){return typeof r==="string"?a(e).fill(t,r):a(e).fill(t)}return a(e)}p.alloc=function(e,t,r){return f(e,t,r)};function h(e){s(e);return a(e<0?0:y(e)|0)}p.allocUnsafe=function(e){return h(e)};p.allocUnsafeSlow=function(e){return h(e)};function l(e,t){if(typeof t!=="string"||t===""){t="utf8"}if(!p.isEncoding(t)){throw new TypeError("Unknown encoding: "+t)}var r=d(e,t)|0;var n=a(r);var i=n.write(e,t);if(i!==r){n=n.slice(0,i)}return n}function u(e){var t=e.length<0?0:y(e.length)|0;var r=a(t);for(var n=0;n<t;n+=1){r[n]=e[n]&255}return r}function c(e,t,r){if(t<0||e.byteLength<t){throw new RangeError('"offset" is outside of buffer bounds')}if(e.byteLength<t+(r||0)){throw new RangeError('"length" is outside of buffer bounds')}var n;if(t===undefined&&r===undefined){n=new Uint8Array(e)}else if(r===undefined){n=new Uint8Array(e,t)}else{n=new Uint8Array(e,t,r)}n.__proto__=p.prototype;return n}function g(e){if(p.isBuffer(e)){var t=y(e.length)|0;var r=a(t);if(r.length===0){return r}e.copy(r,0,0,t);return r}if(e.length!==undefined){if(typeof e.length!=="number"||O(e.length)){return a(0)}return u(e)}if(e.type==="Buffer"&&Array.isArray(e.data)){return u(e.data)}}function y(e){if(e>=r){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+r.toString(16)+" bytes")}return e|0}function t(e){if(+e!=e){e=0}return p.alloc(+e)}p.isBuffer=function e(t){return t!=null&&t._isBuffer===true&&t!==p.prototype};p.compare=function e(t,r){if(U(t,Uint8Array))t=p.from(t,t.offset,t.byteLength);if(U(r,Uint8Array))r=p.from(r,r.offset,r.byteLength);if(!p.isBuffer(t)||!p.isBuffer(r)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(t===r)return 0;var n=t.length;var i=r.length;for(var o=0,a=Math.min(n,i);o<a;++o){if(t[o]!==r[o]){n=t[o];i=r[o];break}}if(n<i)return-1;if(i<n)return 1;return 0};p.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};p.concat=function e(t,r){if(!Array.isArray(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return p.alloc(0)}var n;if(r===undefined){r=0;for(n=0;n<t.length;++n){r+=t[n].length}}var i=p.allocUnsafe(r);var o=0;for(n=0;n<t.length;++n){var a=t[n];if(U(a,Uint8Array)){a=p.from(a)}if(!p.isBuffer(a)){throw new TypeError('"list" argument must be an Array of Buffers')}a.copy(i,o);o+=a.length}return i};function d(e,t){if(p.isBuffer(e)){return e.length}if(ArrayBuffer.isView(e)||U(e,ArrayBuffer)){return e.byteLength}if(typeof e!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof e)}var r=e.length;var n=arguments.length>2&&arguments[2]===true;if(!n&&r===0)return 0;var i=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return _(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return T(e).length;default:if(i){return n?-1:_(e).length}t=(""+t).toLowerCase();i=true}}}p.byteLength=d;function m(e,t,r){var n=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(r===undefined||r>this.length){r=this.length}if(r<=0){return""}r>>>=0;t>>>=0;if(r<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return k(this,t,r);case"utf8":case"utf-8":return C(this,t,r);case"ascii":return N(this,t,r);case"latin1":case"binary":return F(this,t,r);case"base64":return G(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();n=true}}}p.prototype._isBuffer=true;function b(e,t,r){var n=e[t];e[t]=e[r];e[r]=n}p.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var r=0;r<t;r+=2){b(this,r,r+1)}return this};p.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var r=0;r<t;r+=4){b(this,r,r+3);b(this,r+1,r+2)}return this};p.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var r=0;r<t;r+=8){b(this,r,r+7);b(this,r+1,r+6);b(this,r+2,r+5);b(this,r+3,r+4)}return this};p.prototype.toString=function e(){var t=this.length;if(t===0)return"";if(arguments.length===0)return C(this,0,t);return m.apply(this,arguments)};p.prototype.toLocaleString=p.prototype.toString;p.prototype.equals=function e(t){if(!p.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return p.compare(this,t)===0};p.prototype.inspect=function e(){var t="";var r=K.INSPECT_MAX_BYTES;t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim();if(this.length>r)t+=" ... ";return"<Buffer "+t+">"};p.prototype.compare=function e(t,r,n,i,o){if(U(t,Uint8Array)){t=p.from(t,t.offset,t.byteLength)}if(!p.isBuffer(t)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof t)}if(r===undefined){r=0}if(n===undefined){n=t?t.length:0}if(i===undefined){i=0}if(o===undefined){o=this.length}if(r<0||n>t.length||i<0||o>this.length){throw new RangeError("out of range index")}if(i>=o&&r>=n){return 0}if(i>=o){return-1}if(r>=n){return 1}r>>>=0;n>>>=0;i>>>=0;o>>>=0;if(this===t)return 0;var a=o-i;var s=n-r;var f=Math.min(a,s);var h=this.slice(i,o);var l=t.slice(r,n);for(var u=0;u<f;++u){if(h[u]!==l[u]){a=h[u];s=l[u];break}}if(a<s)return-1;if(s<a)return 1;return 0};function w(e,t,r,n,i){if(e.length===0)return-1;if(typeof r==="string"){n=r;r=0}else if(r>2147483647){r=2147483647}else if(r<-2147483648){r=-2147483648}r=+r;if(O(r)){r=i?0:e.length-1}if(r<0)r=e.length+r;if(r>=e.length){if(i)return-1;else r=e.length-1}else if(r<0){if(i)r=0;else return-1}if(typeof t==="string"){t=p.from(t,n)}if(p.isBuffer(t)){if(t.length===0){return-1}return v(e,t,r,n,i)}else if(typeof t==="number"){t=t&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(i){return Uint8Array.prototype.indexOf.call(e,t,r)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,r)}}return v(e,[t],r,n,i)}throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var o=1;var a=e.length;var s=t.length;if(n!==undefined){n=String(n).toLowerCase();if(n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le"){if(e.length<2||t.length<2){return-1}o=2;a/=2;s/=2;r/=2}}function f(e,t){if(o===1){return e[t]}else{return e.readUInt16BE(t*o)}}var h;if(i){var l=-1;for(h=r;h<a;h++){if(f(e,h)===f(t,l===-1?0:h-l)){if(l===-1)l=h;if(h-l+1===s)return l*o}else{if(l!==-1)h-=h-l;l=-1}}}else{if(r+s>a)r=a-s;for(h=r;h>=0;h--){var u=true;for(var p=0;p<s;p++){if(f(e,h+p)!==f(t,p)){u=false;break}}if(u)return h}}return-1}p.prototype.includes=function e(t,r,n){return this.indexOf(t,r,n)!==-1};p.prototype.indexOf=function e(t,r,n){return w(this,t,r,n,true)};p.prototype.lastIndexOf=function e(t,r,n){return w(this,t,r,n,false)};function x(e,t,r,n){r=Number(r)||0;var i=e.length-r;if(!n){n=i}else{n=Number(n);if(n>i){n=i}}var o=t.length;if(n>o/2){n=o/2}for(var a=0;a<n;++a){var s=parseInt(t.substr(a*2,2),16);if(O(s))return a;e[r+a]=s}return a}function A(e,t,r,n){return L(_(t,e.length-r),e,r,n)}function B(e,t,r,n){return L(V(t),e,r,n)}function j(e,t,r,n){return B(e,t,r,n)}function S(e,t,r,n){return L(T(t),e,r,n)}function Y(e,t,r,n){return L(J(t,e.length-r),e,r,n)}p.prototype.write=function e(t,r,n,i){if(r===undefined){i="utf8";n=this.length;r=0}else if(n===undefined&&typeof r==="string"){i=r;n=this.length;r=0}else if(isFinite(r)){r=r>>>0;if(isFinite(n)){n=n>>>0;if(i===undefined)i="utf8"}else{i=n;n=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var o=this.length-r;if(n===undefined||n>o)n=o;if(t.length>0&&(n<0||r<0)||r>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!i)i="utf8";var a=false;for(;;){switch(i){case"hex":return x(this,t,r,n);case"utf8":case"utf-8":return A(this,t,r,n);case"ascii":return B(this,t,r,n);case"latin1":case"binary":return j(this,t,r,n);case"base64":return S(this,t,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,t,r,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase();a=true}}};p.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(e,t,r){if(t===0&&r===e.length){return n.fromByteArray(e)}else{return n.fromByteArray(e.slice(t,r))}}function C(e,t,r){r=Math.min(e.length,r);var n=[];var i=t;while(i<r){var o=e[i];var a=null;var s=o>239?4:o>223?3:o>191?2:1;if(i+s<=r){var f,h,l,u;switch(s){case 1:if(o<128){a=o}break;case 2:f=e[i+1];if((f&192)===128){u=(o&31)<<6|f&63;if(u>127){a=u}}break;case 3:f=e[i+1];h=e[i+2];if((f&192)===128&&(h&192)===128){u=(o&15)<<12|(f&63)<<6|h&63;if(u>2047&&(u<55296||u>57343)){a=u}}break;case 4:f=e[i+1];h=e[i+2];l=e[i+3];if((f&192)===128&&(h&192)===128&&(l&192)===128){u=(o&15)<<18|(f&63)<<12|(h&63)<<6|l&63;if(u>65535&&u<1114112){a=u}}}}if(a===null){a=65533;s=1}else if(a>65535){a-=65536;n.push(a>>>10&1023|55296);a=56320|a&1023}n.push(a);i+=s}return X(n)}var E=4096;function X(e){var t=e.length;if(t<=E){return String.fromCharCode.apply(String,e)}var r="";var n=0;while(n<t){r+=String.fromCharCode.apply(String,e.slice(n,n+=E))}return r}function N(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i){n+=String.fromCharCode(e[i]&127)}return n}function F(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i){n+=String.fromCharCode(e[i])}return n}function k(e,t,r){var n=e.length;if(!t||t<0)t=0;if(!r||r<0||r>n)r=n;var i="";for(var o=t;o<r;++o){i+=q(e[o])}return i}function z(e,t,r){var n=e.slice(t,r);var i="";for(var o=0;o<n.length;o+=2){i+=String.fromCharCode(n[o]+n[o+1]*256)}return i}p.prototype.slice=function e(t,r){var n=this.length;t=~~t;r=r===undefined?n:~~r;if(t<0){t+=n;if(t<0)t=0}else if(t>n){t=n}if(r<0){r+=n;if(r<0)r=0}else if(r>n){r=n}if(r<t)r=t;var i=this.subarray(t,r);i.__proto__=p.prototype;return i};function D(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}p.prototype.readUIntLE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)D(t,r,this.length);var i=this[t];var o=1;var a=0;while(++a<r&&(o*=256)){i+=this[t+a]*o}return i};p.prototype.readUIntBE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n){D(t,r,this.length)}var i=this[t+--r];var o=1;while(r>0&&(o*=256)){i+=this[t+--r]*o}return i};p.prototype.readUInt8=function e(t,r){t=t>>>0;if(!r)D(t,1,this.length);return this[t]};p.prototype.readUInt16LE=function e(t,r){t=t>>>0;if(!r)D(t,2,this.length);return this[t]|this[t+1]<<8};p.prototype.readUInt16BE=function e(t,r){t=t>>>0;if(!r)D(t,2,this.length);return this[t]<<8|this[t+1]};p.prototype.readUInt32LE=function e(t,r){t=t>>>0;if(!r)D(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};p.prototype.readUInt32BE=function e(t,r){t=t>>>0;if(!r)D(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};p.prototype.readIntLE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)D(t,r,this.length);var i=this[t];var o=1;var a=0;while(++a<r&&(o*=256)){i+=this[t+a]*o}o*=128;if(i>=o)i-=Math.pow(2,8*r);return i};p.prototype.readIntBE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)D(t,r,this.length);var i=r;var o=1;var a=this[t+--i];while(i>0&&(o*=256)){a+=this[t+--i]*o}o*=128;if(a>=o)a-=Math.pow(2,8*r);return a};p.prototype.readInt8=function e(t,r){t=t>>>0;if(!r)D(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};p.prototype.readInt16LE=function e(t,r){t=t>>>0;if(!r)D(t,2,this.length);var n=this[t]|this[t+1]<<8;return n&32768?n|4294901760:n};p.prototype.readInt16BE=function e(t,r){t=t>>>0;if(!r)D(t,2,this.length);var n=this[t+1]|this[t]<<8;return n&32768?n|4294901760:n};p.prototype.readInt32LE=function e(t,r){t=t>>>0;if(!r)D(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};p.prototype.readInt32BE=function e(t,r){t=t>>>0;if(!r)D(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};p.prototype.readFloatLE=function e(t,r){t=t>>>0;if(!r)D(t,4,this.length);return o.read(this,t,true,23,4)};p.prototype.readFloatBE=function e(t,r){t=t>>>0;if(!r)D(t,4,this.length);return o.read(this,t,false,23,4)};p.prototype.readDoubleLE=function e(t,r){t=t>>>0;if(!r)D(t,8,this.length);return o.read(this,t,true,52,8)};p.prototype.readDoubleBE=function e(t,r){t=t>>>0;if(!r)D(t,8,this.length);return o.read(this,t,false,52,8)};function P(e,t,r,n,i,o){if(!p.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}p.prototype.writeUIntLE=function e(t,r,n,i){t=+t;r=r>>>0;n=n>>>0;if(!i){var o=Math.pow(2,8*n)-1;P(this,t,r,n,o,0)}var a=1;var s=0;this[r]=t&255;while(++s<n&&(a*=256)){this[r+s]=t/a&255}return r+n};p.prototype.writeUIntBE=function e(t,r,n,i){t=+t;r=r>>>0;n=n>>>0;if(!i){var o=Math.pow(2,8*n)-1;P(this,t,r,n,o,0)}var a=n-1;var s=1;this[r+a]=t&255;while(--a>=0&&(s*=256)){this[r+a]=t/s&255}return r+n};p.prototype.writeUInt8=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,1,255,0);this[r]=t&255;return r+1};p.prototype.writeUInt16LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,2,65535,0);this[r]=t&255;this[r+1]=t>>>8;return r+2};p.prototype.writeUInt16BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,2,65535,0);this[r]=t>>>8;this[r+1]=t&255;return r+2};p.prototype.writeUInt32LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,4,4294967295,0);this[r+3]=t>>>24;this[r+2]=t>>>16;this[r+1]=t>>>8;this[r]=t&255;return r+4};p.prototype.writeUInt32BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,4,4294967295,0);this[r]=t>>>24;this[r+1]=t>>>16;this[r+2]=t>>>8;this[r+3]=t&255;return r+4};p.prototype.writeIntLE=function e(t,r,n,i){t=+t;r=r>>>0;if(!i){var o=Math.pow(2,8*n-1);P(this,t,r,n,o-1,-o)}var a=0;var s=1;var f=0;this[r]=t&255;while(++a<n&&(s*=256)){if(t<0&&f===0&&this[r+a-1]!==0){f=1}this[r+a]=(t/s>>0)-f&255}return r+n};p.prototype.writeIntBE=function e(t,r,n,i){t=+t;r=r>>>0;if(!i){var o=Math.pow(2,8*n-1);P(this,t,r,n,o-1,-o)}var a=n-1;var s=1;var f=0;this[r+a]=t&255;while(--a>=0&&(s*=256)){if(t<0&&f===0&&this[r+a+1]!==0){f=1}this[r+a]=(t/s>>0)-f&255}return r+n};p.prototype.writeInt8=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,1,127,-128);if(t<0)t=255+t+1;this[r]=t&255;return r+1};p.prototype.writeInt16LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,2,32767,-32768);this[r]=t&255;this[r+1]=t>>>8;return r+2};p.prototype.writeInt16BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,2,32767,-32768);this[r]=t>>>8;this[r+1]=t&255;return r+2};p.prototype.writeInt32LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,4,2147483647,-2147483648);this[r]=t&255;this[r+1]=t>>>8;this[r+2]=t>>>16;this[r+3]=t>>>24;return r+4};p.prototype.writeInt32BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)P(this,t,r,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;this[r]=t>>>24;this[r+1]=t>>>16;this[r+2]=t>>>8;this[r+3]=t&255;return r+4};function I(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,i){t=+t;r=r>>>0;if(!i){I(e,t,r,4,34028234663852886e22,-34028234663852886e22)}o.write(e,t,r,n,23,4);return r+4}p.prototype.writeFloatLE=function e(t,r,n){return M(this,t,r,true,n)};p.prototype.writeFloatBE=function e(t,r,n){return M(this,t,r,false,n)};function R(e,t,r,n,i){t=+t;r=r>>>0;if(!i){I(e,t,r,8,17976931348623157e292,-17976931348623157e292)}o.write(e,t,r,n,52,8);return r+8}p.prototype.writeDoubleLE=function e(t,r,n){return R(this,t,r,true,n)};p.prototype.writeDoubleBE=function e(t,r,n){return R(this,t,r,false,n)};p.prototype.copy=function e(t,r,n,i){if(!p.isBuffer(t))throw new TypeError("argument should be a Buffer");if(!n)n=0;if(!i&&i!==0)i=this.length;if(r>=t.length)r=t.length;if(!r)r=0;if(i>0&&i<n)i=n;if(i===n)return 0;if(t.length===0||this.length===0)return 0;if(r<0){throw new RangeError("targetStart out of bounds")}if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");if(i>this.length)i=this.length;if(t.length-r<i-n){i=t.length-r+n}var o=i-n;if(this===t&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(r,n,i)}else if(this===t&&n<r&&r<i){for(var a=o-1;a>=0;--a){t[a+r]=this[a+n]}}else{Uint8Array.prototype.set.call(t,this.subarray(n,i),r)}return o};p.prototype.fill=function e(t,r,n,i){if(typeof t==="string"){if(typeof r==="string"){i=r;r=0;n=this.length}else if(typeof n==="string"){i=n;n=this.length}if(i!==undefined&&typeof i!=="string"){throw new TypeError("encoding must be a string")}if(typeof i==="string"&&!p.isEncoding(i)){throw new TypeError("Unknown encoding: "+i)}if(t.length===1){var o=t.charCodeAt(0);if(i==="utf8"&&o<128||i==="latin1"){t=o}}}else if(typeof t==="number"){t=t&255}if(r<0||this.length<r||this.length<n){throw new RangeError("Out of range index")}if(n<=r){return this}r=r>>>0;n=n===undefined?this.length:n>>>0;if(!t)t=0;var a;if(typeof t==="number"){for(a=r;a<n;++a){this[a]=t}}else{var s=p.isBuffer(t)?t:p.from(t,i);var f=s.length;if(f===0){throw new TypeError('The value "'+t+'" is invalid for argument "value"')}for(a=0;a<n-r;++a){this[a+r]=s[a%f]}}return this};var W=/[^+/0-9A-Za-z-_]/g;function H(e){e=e.split("=")[0];e=e.trim().replace(W,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function q(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function _(e,t){t=t||Infinity;var r;var n=e.length;var i=null;var o=[];for(var a=0;a<n;++a){r=e.charCodeAt(a);if(r>55295&&r<57344){if(!i){if(r>56319){if((t-=3)>-1)o.push(239,191,189);continue}else if(a+1===n){if((t-=3)>-1)o.push(239,191,189);continue}i=r;continue}if(r<56320){if((t-=3)>-1)o.push(239,191,189);i=r;continue}r=(i-55296<<10|r-56320)+65536}else if(i){if((t-=3)>-1)o.push(239,191,189)}i=null;if(r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else{throw new Error("Invalid code point")}}return o}function V(e){var t=[];for(var r=0;r<e.length;++r){t.push(e.charCodeAt(r)&255)}return t}function J(e,t){var r,n,i;var o=[];for(var a=0;a<e.length;++a){if((t-=2)<0)break;r=e.charCodeAt(a);n=r>>8;i=r%256;o.push(i);o.push(n)}return o}function T(e){return n.toByteArray(H(e))}function L(e,t,r,n){for(var i=0;i<n;++i){if(i+r>=t.length||i>=e.length)break;t[i+r]=e[i]}return i}function U(e,t){return e instanceof t||e!=null&&e.constructor!=null&&e.constructor.name!=null&&e.constructor.name===t.name}function O(e){return e!==e}}).call(this)}).call(this,Z("buffer").Buffer)},{"base64-js":10,buffer:11,ieee754:12}],12:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a;var s=i*8-n-1;var f=(1<<s)-1;var h=f>>1;var l=-7;var u=r?i-1:0;var p=r?-1:1;var c=e[t+u];u+=p;o=c&(1<<-l)-1;c>>=-l;l+=s;for(;l>0;o=o*256+e[t+u],u+=p,l-=8){}a=o&(1<<-l)-1;o>>=-l;l+=n;for(;l>0;a=a*256+e[t+u],u+=p,l-=8){}if(o===0){o=1-h}else if(o===f){return a?NaN:(c?-1:1)*Infinity}else{a=a+Math.pow(2,n);o=o-h}return(c?-1:1)*a*Math.pow(2,o-n)};r.write=function(e,t,r,n,i,o){var a,s,f;var h=o*8-i-1;var l=(1<<h)-1;var u=l>>1;var p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0;var c=n?0:o-1;var g=n?1:-1;var y=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){s=isNaN(t)?1:0;a=l}else{a=Math.floor(Math.log(t)/Math.LN2);if(t*(f=Math.pow(2,-a))<1){a--;f*=2}if(a+u>=1){t+=p/f}else{t+=p*Math.pow(2,1-u)}if(t*f>=2){a++;f/=2}if(a+u>=l){s=0;a=l}else if(a+u>=1){s=(t*f-1)*Math.pow(2,i);a=a+u}else{s=t*Math.pow(2,u-1)*Math.pow(2,i);a=0}}for(;i>=8;e[r+c]=s&255,c+=g,s/=256,i-=8){}a=a<<i|s;h+=i;for(;h>0;e[r+c]=a&255,c+=g,a/=256,h-=8){}e[r+c-g]|=y*128}},{}]},{},[9])(9)});