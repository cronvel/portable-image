(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.PortableImage=e()}})(function(){var e,t,r;return function(){function l(a,s,o){function h(r,e){if(!s[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(f)return f(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return h(t||e)},i,i.exports,l,a,s,o)}return s[r].exports}for(var f="function"==typeof require&&require,e=0;e<o.length;e++)h(o[e]);return h}return l}()({1:[function(e,t,r){"use strict";function n(){this.name="";this.loop=false;this.startFrame=0;this.endFrame=0}t.exports=n},{}],2:[function(e,t,r){"use strict";function n(e,t={}){this.sprite=e;this.startFrame=+t.startFrame||0;this.endFrame=t.endFrame??e.frames.length;this.useCache=!!t.useCache;this.scaleX=t.scaleX??t.scale??1;this.scaleY=t.scaleY??t.scale??1;this.blitParams={scaleX:this.scaleX,scaleY:this.scaleY};this.x=+t.x||0;this.y=+t.y||0;this.imageData=this.sprite.prepareImageData(this.blitParams);this.ctx=t.ctx;this.running=false;this.frameIndex=0}t.exports=n;n.prototype.start=function(){if(this.running){return}this.running=true;this.runLoop()};n.prototype.stop=function(){this.running=false};n.prototype.runLoop=function(){if(!this.running){return}var e,t=this.sprite.frames[this.frameIndex];if(this.useCache){if(!t.imageDataCache){t.updateImageData(null,this.blitParams)}e=t.imageDataCache}else{if(this.imageData){t.updateImageData(this.imageData,this.blitParams)}else{this.imageData=t.createImageData(this.blitParams)}e=this.imageData}this.ctx.putImageData(e,this.x,this.y);this.frameIndex++;if(this.frameIndex>=this.endFrame){this.frameIndex=this.startFrame}setTimeout(()=>this.runLoop(),t.duration)}},{}],3:[function(e,t,r){"use strict";function n(e={}){this.imageIndex=+e.imageIndex||0;this.x=+e.x||0;this.y=+e.y||0}t.exports=n},{}],4:[function(e,t,r){"use strict";function o(e={}){this.channels=Array.isArray(e.channels)?e.channels:o.RGBA;this.indexed=!!e.indexed||Array.isArray(e.palette);this.bytesPerPixel=this.indexed?1:this.channels.length;this.palette=this.indexed?[]:null;if(Array.isArray(e.palette)){this.setPalette(e.palette)}this.channelIndex={};for(let e=0;e<this.channels.length;e++){this.channelIndex[this.channels[e]]=e}this.isRgbCompatible=this.channels.length>=3&&this.channels[0]==="red"&&this.channels[1]==="green"&&this.channels[2]==="blue";this.isRgbaCompatible=this.channels.length>=4&&this.isRgbCompatible&&this.channels[3]==="alpha";this.isRgb=this.isRgbCompatible&&this.channels.length===3;this.isRgba=this.isRgbaCompatible&&this.channels.length===4;this.isGrayCompatible=this.channels.length>=1&&this.channels[0]==="gray";this.isGrayAlphaCompatible=this.channels.length>=2&&this.isGrayCompatible&&this.channels[1]==="alpha";this.isGray=this.isGrayCompatible&&this.channels.length===1;this.isGrayAlpha=this.isGrayAlphaCompatible&&this.channels.length===2}t.exports=o;const n=o.Mapping=e("./Mapping.js");o.Mapping=n;o.DirectChannelMapping=n.DirectChannelMapping;o.DirectChannelMappingWithDefault=n.DirectChannelMappingWithDefault;o.MatrixChannelMapping=n.MatrixChannelMapping;o.compositing=e("./compositing.js");o.RGB=["red","green","blue"];o.RGBA=["red","green","blue","alpha"];o.GRAY=["gray"];o.GRAY_ALPHA=["gray","alpha"];o.prototype.clone=function(){return new o({channels:[...this.channels],indexed:this.indexed,palette:this.palette})};o.prototype.setPalette=function(t){if(!this.indexed){throw new Error("This is not an indexed image")}this.palette.length=0;for(let e=0;e<t.length;e++){this.setPaletteEntry(e,t[e])}};o.prototype.setPaletteEntry=function(e,t){if(this.isRgb||this.isRgba){return this.setPaletteColor(e,t)}if(!this.indexed){throw new Error("This is not an indexed image")}if(!t){return}var r=this.palette[e];if(!r){r=this.palette[e]=[]}if(Array.isArray(t)){for(let e=0;e<this.channels.length;e++){r[e]=t[e]??0}}else if(typeof t==="object"){for(let e=0;e<this.channels.length;e++){r[e]=t[this.channels[e]]??0}}};const i=255;o.prototype.setPaletteColor=function(e,t){if(!this.indexed){throw new Error("This is not an indexed image")}if(!t){return}var r=this.palette[e];if(!r){r=this.palette[e]=[]}if(Array.isArray(t)){r[0]=t[0]??0;r[1]=t[1]??0;r[2]=t[2]??0;if(this.isRgba){r[3]=t[3]??255}}else if(typeof t==="object"){r[0]=t.R??t.r??0;r[1]=t.G??t.g??0;r[2]=t.B??t.b??0;if(this.isRgba){r[3]=t.A??t.a??255}}else if(typeof t==="string"&&t[0]==="#"){t=t.slice(1);if(t.length===3){t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}let e=Number.parseInt(t,16);if(t.length===6){r[0]=e>>16&i;r[1]=e>>8&i;r[2]=e&i;if(this.isRgba){r[3]=255}}else if(t.length===8){r[0]=e>>24&i;r[1]=e>>16&i;r[2]=e>>8&i;if(this.isRgba){r[3]=e&i}}}};o.prototype.hasSamePalette=function(n){if(!this.palette||!n.palette){return false}if(this.palette.length!==n.palette.length){return false}for(let r=0;r<this.palette.length;r++){let t=this.palette[r];for(let e=0;e<t.length;e++){if(t[e]!==n.palette[r][e]){return false}}}return true};o.DEFAULT_CHANNEL_VALUES={red:0,green:0,blue:0,alpha:255};o.prototype.getAutoMappingToChannels=function(r,n=o.DEFAULT_CHANNEL_VALUES){var i=new Array(r.length*2);for(let t=0;t<r.length;t++){let e=r[t];if(Object.hasOwn(this.channelIndex,e)){i[t*2]=this.channelIndex[e];i[t*2+1]=null}else{i[t*2]=null;i[t*2+1]=n[e]??0}}return new o.DirectChannelMappingWithDefault(i)};o.getAutoMapping=function(n,i,a=o.DEFAULT_CHANNEL_VALUES){var s=new Array(i.length*2);for(let r=0;r<i.length;r++){let e=i[r];let t=n.indexOf(e);if(t>=0){s[r*2]=t;s[r*2+1]=null}else{s[r*2]=null;s[r*2+1]=a[e]??0}}return new o.DirectChannelMappingWithDefault(s)};o.prototype.getClosestPaletteIndex=i=>{var e=Math.min(this.channels.length,i.length),a=Infinity,s=0;for(let n=0;n<this.palette.length;n++){let r=0;for(let t=0;t<e;t++){let e=this.palette[n][t]-i[t];r+=e*e;if(r<a){a=r;s=n}}}return s}},{"./Mapping.js":8,"./compositing.js":10}],5:[function(e,t,r){"use strict";function n(e={},t=null){Object.defineProperty(this,"sprite",{configurable:true,value:t});this.duration=e.duration;this.cells=[];this.imageDataCache=null}t.exports=n;const i=e("./Sprite.js");const a=e("./Layer.js");const s=e("./Cell.js");const o=e("./Image.js");n.prototype.setParent=function(e){Object.defineProperty(this,"sprite",{value:e})};n.prototype.clearCache=function(){this.imageDataCache=null};n.prototype.addCell=function(e){this.cells.push(e);return this.cells.length-1};n.prototype.toImage=function(e=o,t=false){var r=new o({width:this.sprite.width,height:this.sprite.height,channelDef:t?this.sprite.channelDef:this.sprite.channelDef.clone()});for(let t of this.cells){let e=this.sprite.images[t.imageIndex];e.copyTo(r,{compositing:o.compositing.binaryOver,x:t.x,y:t.y});console.log("Copy from/to:",r,e," --- cell: ",t)}return r};n.prototype.flatten=function(){var e=this.toImage(o,true);var t=this.sprite.addImage(e);this.cells[0]=new s({imageIndex:t});this.cells.length=1;return e};n.prototype.prepareImageData=function(e={}){return this.sprite.prepareImageData(e)};n.prototype.createImageData=function(e={}){var t=this.sprite.prepareImageData(e);this.updateImageData(t,e,true);return t};n.prototype.updateImageData=function(r,n,e=false){n=n?Object.assign({},n):{};if(!r){if(this.imageDataCache){r=this.imageDataCache;if(!e){r.data.fill(0)}}else{r=this.imageDataCache=this.sprite.prepareImageData(n)}}else if(!e){r.data.fill(0)}for(let t of this.cells){let e=this.sprite.images[t.imageIndex];n.innerX=t.x;n.innerY=t.y;n.compositing=o.compositing.binaryOver;e.updateImageData(r,n,true)}}},{"./Cell.js":3,"./Image.js":6,"./Layer.js":7,"./Sprite.js":9}],6:[function(e,r,t){(function(t){(function(){"use strict";function h(e={}){this.width=e.width;this.height=e.height;this.channelDef=e.channelDef??new f(e);this.pixelBuffer=null;if(e.pixelBuffer){if(e.pixelBuffer instanceof t){if(e.pixelBuffer.length!==this.width*this.height*this.channelDef.bytesPerPixel){throw new Error("Provided pixel Buffer mismatch the expected size (should be exactly width * height * bytesPerPixel)")}this.pixelBuffer=e.pixelBuffer}else if(e.pixelBuffer instanceof Uint8Array){if(e.pixelBuffer.length!==this.width*this.height*this.channelDef.bytesPerPixel){throw new Error("Provided pixel Uint8Array buffer mismatch the expected size (should be exactly width * height * bytesPerPixel)")}this.pixelBuffer=t.from(e.pixelBuffer)}else{throw new Error("Provided pixel buffer is not a Buffer or a Uint8Array")}}else{this.pixelBuffer=t.allocUnsafe(this.width*this.height*this.channelDef.bytesPerPixel)}}r.exports=h;const f=h.ChannelDef=h.prototype.ChannelDef=e("./ChannelDef.js");h.compositing=e("./compositing.js");h.prototype.setPalette=function(e){this.channelDef.setPalette(e)};h.prototype.setPaletteEntry=function(e,t){this.channelDef.setPaletteEntry(e,t)};h.prototype.setPaletteColor=function(e,t){this.channelDef.setPaletteColor(e,t)};h.prototype.hasSamePalette=function(e){return this.channelDef.hasSamePalette(e.channelDef)};h.prototype.getAutoMappingTo=function(e,t=f.DEFAULT_CHANNEL_VALUES){return this.channelDef.getAutoMappingToChannels(e.channelDef.channels,t)};h.prototype.copyTo=function(e,t={}){var r=t.mapping,n=t.scaleX??t.scale??1,i=t.scaleY??t.scale??1;if(!r){r=this.getAutoMappingTo(e)}let a={buffer:this.pixelBuffer,width:this.width,height:this.height,bytesPerPixel:this.channelDef.bytesPerPixel,x:Math.max(0,-((+t.x||0)/n+(+t.innerX||0))),y:Math.max(0,-((+t.y||0)/i+(+t.innerY||0))),endX:this.width,endY:this.height,channels:this.channelDef.channels.length,scaleX:n,scaleY:i,mapping:r,compositing:t.compositing||null};let s={buffer:e.pixelBuffer,width:e.width,height:e.height,bytesPerPixel:e.channelDef.bytesPerPixel,x:Math.max(0,(+t.x||0)+(+t.innerX||0)*n),y:Math.max(0,(+t.y||0)+(+t.innerY||0)*i),endX:e.width,endY:e.height,channels:e.channelDef.channels.length};if(a.compositing){if(this.channelDef.indexed){if(e.channelDef.indexed){if(!this.hasSamePalette(e)){throw new Error("Uncompatible palettes are not supported yet")}a.palette=this.channelDef.palette;if(a.compositing.id==="binaryOver"&&this.channelDef.channelIndex.alpha!==undefined){a.alphaChannel=this.channelDef.channelIndex.alpha;h.fullIndexedBlitWithTransparency(a,s)}else{throw new Error("Copy indexed to indexed with compositing is not supported yet, except for 'binaryOver' mode")}}else{a.palette=this.channelDef.palette;h.compositingBlitFromIndexed(a,s)}}else{if(e.channelDef.indexed){throw new Error("Copy to indexed portable image is not supported yet")}h.compositingBlit(a,s)}}else{if(this.channelDef.indexed){if(e.channelDef.indexed){if(!this.hasSamePalette(e)){throw new Error("Uncompatible palettes are not supported yet")}a.mapping=f.Mapping.INDEXED_TO_INDEXED;h.blit(a,s)}else{a.palette=this.channelDef.palette;h.blitFromIndexed(a,s)}}else{if(e.channelDef.indexed){throw new Error("Copy to indexed portable image is not supported yet")}h.blit(a,s)}}};h.prototype.prepareImageData=function(e={}){var t=e.scaleX??e.scale??1,r=e.scaleY??e.scale??1;return new ImageData(this.width*t,this.height*r)};h.prototype.createImageData=function(e={}){var t=this.prepareImageData(e);this.updateImageData(t,e,true);return t};h.prototype.updateImageData=function(e,t={},r=false){var n=t.mapping,i=t.scaleX??t.scale??1,a=t.scaleY??t.scale??1;if(!r){e.data.fill(0)}if(!n){if(e.width===this.width&&e.height===this.height&&!t.x&&!t.y&&i===1&&a===1){if(this.channelDef.indexed){if(this.channelDef.isRgbaCompatible){return this.isoIndexedRgbaCompatibleToRgbaBlit(e.data)}if(this.channelDef.isRgbCompatible){return this.isoIndexedRgbCompatibleToRgbaBlit(e.data)}}else{if(this.channelDef.isRgbaCompatible){return this.isoRgbaCompatibleToRgbaBlit(e.data)}if(this.channelDef.isRgbCompatible){return this.isoRgbCompatibleToRgbaBlit(e.data)}}}if(this.channelDef.isRgbaCompatible){n=f.Mapping.RGBA_COMPATIBLE_TO_RGBA}else if(this.channelDef.isRgbCompatible){n=f.Mapping.RGB_COMPATIBLE_TO_RGBA}else if(this.channelDef.isGrayAlphaCompatible){n=f.Mapping.GRAY_ALPHA_COMPATIBLE_TO_RGBA}else if(this.channelDef.isGrayCompatible){n=f.Mapping.GRAY_COMPATIBLE_TO_RGBA}else{throw new Error("Mapping required for image that are not RGB/RGBA/Grayscale/Grayscale+Alpha compatible")}}let s={buffer:this.pixelBuffer,width:this.width,height:this.height,bytesPerPixel:this.channelDef.bytesPerPixel,x:Math.max(0,-((+t.x||0)/i+(+t.innerX||0))),y:Math.max(0,-((+t.y||0)/a+(+t.innerY||0))),endX:this.width,endY:this.height,channels:this.channelDef.channels.length,scaleX:i,scaleY:a,mapping:n,compositing:t.compositing||null};let o={buffer:e.data,width:e.width,height:e.height,bytesPerPixel:4,x:Math.max(0,(+t.x||0)+(+t.innerX||0)*i),y:Math.max(0,(+t.y||0)+(+t.innerY||0)*a),endX:e.width,endY:e.height,channels:4};if(s.compositing){if(this.channelDef.indexed){s.palette=this.channelDef.palette;h.compositingBlitFromIndexed(s,o)}else{h.compositingBlit(s,o)}}else{if(this.channelDef.indexed){s.palette=this.channelDef.palette;h.blitFromIndexed(s,o)}else{h.blit(s,o)}}};h.blit=function(i,a){var e=Math.min(a.endX-a.x,(i.endX-i.x)*i.scaleX),t=Math.min(a.endY-a.y,(i.endY-i.y)*i.scaleY);for(let n=0;n<t;n++){for(let r=0;r<e;r++){let e=((a.y+n)*a.width+(a.x+r))*a.bytesPerPixel;let t=(Math.floor(i.y+n/i.scaleY)*i.width+Math.floor(i.x+r/i.scaleX))*i.bytesPerPixel;i.mapping.map(i,a,t,e)}}};h.blitFromIndexed=function(a,s){var e=Math.min(s.endX-s.x,(a.endX-a.x)*a.scaleX),t=Math.min(s.endY-s.y,(a.endY-a.y)*a.scaleY);for(let i=0;i<t;i++){for(let n=0;n<e;n++){let e=((s.y+i)*s.width+(s.x+n))*s.bytesPerPixel;let t=(Math.floor(a.y+i/a.scaleY)*a.width+Math.floor(a.x+n/a.scaleX))*a.bytesPerPixel;let r=a.palette[a.buffer[t]];a.mapping.map(a,s,0,e,r)}}};h.compositingBlit=function(i,a){var e=Math.min(a.endX-a.x,(i.endX-i.x)*i.scaleX),t=Math.min(a.endY-a.y,(i.endY-i.y)*i.scaleY);for(let n=0;n<t;n++){for(let r=0;r<e;r++){let e=((a.y+n)*a.width+(a.x+r))*a.bytesPerPixel;let t=(Math.floor(i.y+n/i.scaleY)*i.width+Math.floor(i.x+r/i.scaleX))*i.bytesPerPixel;i.mapping.compose(i,a,t,e,i.compositing)}}};h.compositingBlitFromIndexed=function(a,s){var e=Math.min(s.endX-s.x,(a.endX-a.x)*a.scaleX),t=Math.min(s.endY-s.y,(a.endY-a.y)*a.scaleY);for(let i=0;i<t;i++){for(let n=0;n<e;n++){let e=((s.y+i)*s.width+(s.x+n))*s.bytesPerPixel;let t=(Math.floor(a.y+i/a.scaleY)*a.width+Math.floor(a.x+n/a.scaleX))*a.bytesPerPixel;let r=a.palette[a.buffer[t]];a.mapping.compose(a,s,0,e,a.compositing,r)}}};h.fullIndexedBlitWithTransparency=function(i,a){var e=Math.min(a.endX-a.x,(i.endX-i.x)*i.scaleX),t=Math.min(a.endY-a.y,(i.endY-i.y)*i.scaleY);for(let n=0;n<t;n++){for(let r=0;r<e;r++){let e=((a.y+n)*a.width+(a.x+r))*a.bytesPerPixel;let t=(Math.floor(i.y+n/i.scaleY)*i.width+Math.floor(i.x+r/i.scaleX))*i.bytesPerPixel;if(i.palette[i.buffer[t]][i.alphaChannel]){a.buffer[e]=i.buffer[t]}}}};h.prototype.isoRgbCompatibleToRgbaBlit=function(n){for(let r=0,e=this.width*this.height;r<e;r++){let e=r*this.channelDef.bytesPerPixel;let t=r*4;n[t]=this.pixelBuffer[e];n[t+1]=this.pixelBuffer[e+1];n[t+2]=this.pixelBuffer[e+2];n[t+3]=255}};h.prototype.isoRgbaCompatibleToRgbaBlit=function(n){for(let r=0,e=this.width*this.height;r<e;r++){let e=r*this.channelDef.bytesPerPixel;let t=r*4;n[t]=this.pixelBuffer[e];n[t+1]=this.pixelBuffer[e+1];n[t+2]=this.pixelBuffer[e+2];n[t+3]=this.pixelBuffer[e+3]}};h.prototype.isoIndexedRgbCompatibleToRgbaBlit=function(i){for(let n=0,e=this.width*this.height;n<e;n++){let e=n*this.channelDef.bytesPerPixel;let t=n*4;let r=this.channelDef.palette[this.pixelBuffer[e]];i[t]=r[0];i[t+1]=r[1];i[t+2]=r[2];i[t+3]=255}};h.prototype.isoIndexedRgbaCompatibleToRgbaBlit=function(i){for(let n=0,e=this.width*this.height;n<e;n++){let e=n*this.channelDef.bytesPerPixel;let t=n*4;let r=this.channelDef.palette[this.pixelBuffer[e]];i[t]=r[0];i[t+1]=r[1];i[t+2]=r[2];i[t+3]=r[3]}};h.prototype.updateFromImageData=function(e,t){throw new Error("Not coded!")}}).call(this)}).call(this,e("buffer").Buffer)},{"./ChannelDef.js":4,"./compositing.js":10,buffer:13}],7:[function(e,t,r){"use strict";function n(e,t={}){this.name=e||"";this.visible=t.visible??true;this.compositing=t.compositing??null;this.opacity=t.opacity??1;this.order=t.order??0}t.exports=n},{}],8:[function(e,t,r){"use strict";function n(e,t){this.matrix=e;this.alphaChannelDst=t??null;this.composeChannelOrder=null;if(this.alphaChannelDst===null){this.compose=this.map}else{this.composeChannelOrder=[this.alphaChannelDst];for(let e=0;e<this.dstChannels;e++){if(e!==this.alphaChannelDst){this.composeChannelOrder.push(e)}}}}n.prototype.map=function(){};n.prototype.compose=function(){};t.exports=n;function o(e){return Math.max(0,Math.min(255,Math.round(e)))}function l(e){return Math.max(0,Math.min(255,Math.round(255*e)))}function u(e){return Math.max(0,Math.min(1,e/255))}const p={alpha:e=>e,channel:(e,t,r)=>r};function i(e,t){this.dstChannels=e.length;n.call(this,e,t)}i.prototype=Object.create(n.prototype);i.prototype.constructor=i;n.DirectChannelMapping=i;i.prototype.map=function(e,t,r,n,i=e.buffer){for(let e=0;e<t.channels;e++){t.buffer[n+e]=i[r+this.matrix[e]]}};i.prototype.compose=function(e,t,r,n,i=p,a=e.buffer){let s=t.buffer[n+this.alphaChannelDst]/255;let o=1;for(let e of this.composeChannelOrder){if(e===this.alphaChannelDst){o=a[r+this.matrix[e]]/255;t.buffer[n+e]=l(i.alpha(o,s))}else{t.buffer[n+e]=l(i.channel(o,s,a[r+this.matrix[e]]/255,t.buffer[n+e]/255))}}};function a(e,t){this.dstChannels=Math.floor(e.length/2);n.call(this,e,t)}a.prototype=Object.create(n.prototype);a.prototype.constructor=a;n.DirectChannelMappingWithDefault=a;a.prototype.map=function(e,t,r,n,i=e.buffer){for(let e=0;e<t.channels;e++){t.buffer[n+e]=this.matrix[e*2+1]??i[r+this.matrix[e*2]]}};a.prototype.compose=function(e,t,r,n,i=p,a=e.buffer){let s=t.buffer[n+this.alphaChannelDst]/255;let o=1;for(let e of this.composeChannelOrder){if(e===this.alphaChannelDst){o=(this.matrix[e*2+1]??a[r+this.matrix[e*2]])/255;t.buffer[n+e]=l(i.alpha(o,s))}else{t.buffer[n+e]=l(i.channel(o,s,(this.matrix[e*2+1]??a[r+this.matrix[e*2]])/255,t.buffer[n+e]/255))}}};function s(e,t,r){this.dstChannels=Math.floor(e.length/(t+1));this.srcChannelsUsed=t;n.call(this,e,r)}s.prototype=Object.create(n.prototype);s.prototype.constructor=s;n.MatrixChannelMapping=s;s.prototype.map=function(e,r,n,i,a=e.buffer){let s=0;for(let e=0;e<r.channels;e++){let t=0;for(let e=0;e<this.srcChannelsUsed;e++){t+=a[n+e]*this.matrix[s++]}t+=this.matrix[s++];r.buffer[i+e]=o(t)}};s.prototype.compose=function(e,n,i,a,s=p,o=e.buffer){let h=n.buffer[a+this.alphaChannelDst]/255;let f=1;for(let e of this.composeChannelOrder){let t=e*(this.srcChannelsUsed+1);let r=0;for(let e=0;e<this.srcChannelsUsed;e++){r+=o[i+e]*this.matrix[t++]}r+=this.matrix[t++];r=u(r);if(e===this.alphaChannelDst){n.buffer[a+e]=l(s.alpha(r,h))}else{n.buffer[a+e]=l(s.channel(f,h,r,n.buffer[a+e]/255))}}};n.INDEXED_TO_INDEXED=new i([0]);n.RGBA_COMPATIBLE_TO_RGBA=new i([0,1,2,3],3);n.RGB_COMPATIBLE_TO_RGBA=new a([0,null,1,null,2,null,null,255],3);n.GRAY_ALPHA_COMPATIBLE_TO_RGBA=new i([0,0,0,1],3);n.GRAY_COMPATIBLE_TO_RGBA=new a([0,null,0,null,0,null,null,255],3);n.RGBA_COMPATIBLE_TO_GRAY_ALPHA=new s([1/3,1/3,1/3,0,0,0,0,0,1,0],4,1);n.RGB_COMPATIBLE_TO_GRAY_ALPHA=new s([1/3,1/3,1/3,0,0,0,0,255],3,1)},{}],9:[function(e,t,r){"use strict";function n(e={}){this.width=e.width;this.height=e.height;this.channelDef=e.channelDef??new i(e);this.images=[];this.layers=[];this.frames=[];this.animations=[];this.orderedLayers=[];this.animationByName=new Map}t.exports=n;const i=n.ChannelDef=n.prototype.ChannelDef=e("./ChannelDef.js");const a=n.Image=n.prototype.Image=e("./Image.js");const s=n.Frame=n.prototype.Frame=e("./Frame.js");const o=n.Layer=n.prototype.Layer=e("./Layer.js");const h=n.Cell=n.prototype.Cell=e("./Cell.js");const f=n.Animation=n.prototype.Animation=e("./Animation.js");const l=n.Animator=n.prototype.Animator=e("./Animator.js");n.prototype.addImage=function(e){this.images.push(e);return this.images.length-1};n.prototype.addFrame=function(e){e.setParent(this);this.frames.push(e);return this.frames.length-1};n.prototype.addLayer=function(e){this.layers.push(e);var t=this.layers.length-1;e.order=t;this.orderedLayers.push(t);return t};n.prototype.toImage=function(e){return this.frames[0].toImage(e)};n.prototype.flatten=function(){for(let e of this.frames){e.flatten()}this.cleanImageIndexes()};n.prototype.cleanImageIndexes=function(){var r=new Array(this.images.length).fill(false);for(let t of this.frames){for(let e of t.cells){r[e.imageIndex]=true}}var t=0,n=new Array(this.images.length);for(let e=0;e<r.length;e++){if(r[e]){if(e!==t){this.images[t]=this.images[e]}n[e]=t;t++}}this.images.length=t;for(let t of this.frames){for(let e of t.cells){e.imageIndex=n[e.imageIndex]}}};n.prototype.prepareImageData=function(e={}){var t=e.scaleX??e.scale??1,r=e.scaleY??e.scale??1;return new ImageData(this.width*t,this.height*r)};n.prototype.createAnimator=function(e={}){return new l(this,e)};n.prototype.clearCache=function(){for(let e of this.frames){e.clearCache()}}},{"./Animation.js":1,"./Animator.js":2,"./Cell.js":3,"./ChannelDef.js":4,"./Frame.js":5,"./Image.js":6,"./Layer.js":7}],10:[function(e,t,r){"use strict";const i={};t.exports=i;i.normal=i.over={id:"over",alpha:(e,t)=>e+t*(1-e),channel:(e,t,r,n)=>(r*e+n*t*(1-e))/(e+t*(1-e))||0};i.binaryOver={id:"binaryOver",alpha:(e,t)=>e?1:t,channel:(e,t,r,n)=>e?r:n};i.in={id:"in",alpha:(e,t)=>e*t,channel:i.normal.channel};i.out={id:"out",alpha:(e,t)=>e*(1-t),channel:(e,t,r,n)=>(r*e+n*(1-t)*(1-e))/(e+(1-t)*(1-e))||0};i.atop={id:"atop",alpha:(e,t)=>i.normal.alpha(e,t)*t,channel:i.normal.channel};i.xor={id:"xor",alpha:(e,t)=>e*(1-t)+t*(1-e),channel:i.normal.channel};i.multiply={id:"multiply",alpha:i.normal.alpha,channel:(e,t,r,n)=>i.normal.channel(e,t,r*(1+(n-1)*t),n)};i.screen={id:"screen",alpha:i.normal.alpha,channel:(e,t,r,n)=>i.normal.channel(e,t,1-(1-r)*(1-n*t),n)};i.overlay={id:"overlay",alpha:i.normal.alpha,channel:(e,t,r,n)=>i.normal.channel(e,t,1+(n-1)*t<.5?2*r*(1+(n-1)*t):n*t>.5?1-2*(1-r)*(1-n*t):r,n)}},{}],11:[function(e,t,r){"use strict";const n={};t.exports=n;n.Image=e("./Image.js");n.Sprite=e("./Sprite.js");n.Mapping=e("./Mapping.js");n.compositing=e("./compositing.js")},{"./Image.js":6,"./Mapping.js":8,"./Sprite.js":9,"./compositing.js":10}],12:[function(e,t,r){"use strict";r.byteLength=s;r.toByteArray=o;r.fromByteArray=y;var h=[];var f=[];var l=typeof Uint8Array!=="undefined"?Uint8Array:Array;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,a=n.length;i<a;++i){h[i]=n[i];f[n.charCodeAt(i)]=i}f["-".charCodeAt(0)]=62;f["_".charCodeAt(0)]=63;function u(e){var t=e.length;if(t%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var r=e.indexOf("=");if(r===-1)r=t;var n=r===t?0:4-r%4;return[r,n]}function s(e){var t=u(e);var r=t[0];var n=t[1];return(r+n)*3/4-n}function p(e,t,r){return(t+r)*3/4-r}function o(e){var t;var r=u(e);var n=r[0];var i=r[1];var a=new l(p(e,n,i));var s=0;var o=i>0?n-4:n;var h;for(h=0;h<o;h+=4){t=f[e.charCodeAt(h)]<<18|f[e.charCodeAt(h+1)]<<12|f[e.charCodeAt(h+2)]<<6|f[e.charCodeAt(h+3)];a[s++]=t>>16&255;a[s++]=t>>8&255;a[s++]=t&255}if(i===2){t=f[e.charCodeAt(h)]<<2|f[e.charCodeAt(h+1)]>>4;a[s++]=t&255}if(i===1){t=f[e.charCodeAt(h)]<<10|f[e.charCodeAt(h+1)]<<4|f[e.charCodeAt(h+2)]>>2;a[s++]=t>>8&255;a[s++]=t&255}return a}function c(e){return h[e>>18&63]+h[e>>12&63]+h[e>>6&63]+h[e&63]}function g(e,t,r){var n;var i=[];for(var a=t;a<r;a+=3){n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(e[a+2]&255);i.push(c(n))}return i.join("")}function y(e){var t;var r=e.length;var n=r%3;var i=[];var a=16383;for(var s=0,o=r-n;s<o;s+=a){i.push(g(e,s,s+a>o?o:s+a))}if(n===1){t=e[r-1];i.push(h[t>>2]+h[t<<4&63]+"==")}else if(n===2){t=(e[r-2]<<8)+e[r-1];i.push(h[t>>10]+h[t>>4&63]+h[t<<2&63]+"=")}return i.join("")}},{}],13:[function(Z,e,K){(function(e){(function(){"use strict";var n=Z("base64-js");var a=Z("ieee754");K.Buffer=p;K.SlowBuffer=t;K.INSPECT_MAX_BYTES=50;var r=2147483647;K.kMaxLength=r;p.TYPED_ARRAY_SUPPORT=e();if(!p.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function e(){try{var e=new Uint8Array(1);e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return e.foo()===42}catch(e){return false}}Object.defineProperty(p.prototype,"parent",{enumerable:true,get:function(){if(!p.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(p.prototype,"offset",{enumerable:true,get:function(){if(!p.isBuffer(this))return undefined;return this.byteOffset}});function s(e){if(e>r){throw new RangeError('The value "'+e+'" is invalid for option "size"')}var t=new Uint8Array(e);t.__proto__=p.prototype;return t}function p(e,t,r){if(typeof e==="number"){if(typeof t==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return f(e)}return i(e,t,r)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&p[Symbol.species]===p){Object.defineProperty(p,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}p.poolSize=8192;function i(e,t,r){if(typeof e==="string"){return l(e,t)}if(ArrayBuffer.isView(e)){return u(e)}if(e==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof e)}if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer)){return c(e,t,r)}if(typeof e==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var n=e.valueOf&&e.valueOf();if(n!=null&&n!==e){return p.from(n,t,r)}var i=g(e);if(i)return i;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof e[Symbol.toPrimitive]==="function"){return p.from(e[Symbol.toPrimitive]("string"),t,r)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof e)}p.from=function(e,t,r){return i(e,t,r)};p.prototype.__proto__=Uint8Array.prototype;p.__proto__=Uint8Array;function o(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be of type number')}else if(e<0){throw new RangeError('The value "'+e+'" is invalid for option "size"')}}function h(e,t,r){o(e);if(e<=0){return s(e)}if(t!==undefined){return typeof r==="string"?s(e).fill(t,r):s(e).fill(t)}return s(e)}p.alloc=function(e,t,r){return h(e,t,r)};function f(e){o(e);return s(e<0?0:y(e)|0)}p.allocUnsafe=function(e){return f(e)};p.allocUnsafeSlow=function(e){return f(e)};function l(e,t){if(typeof t!=="string"||t===""){t="utf8"}if(!p.isEncoding(t)){throw new TypeError("Unknown encoding: "+t)}var r=d(e,t)|0;var n=s(r);var i=n.write(e,t);if(i!==r){n=n.slice(0,i)}return n}function u(e){var t=e.length<0?0:y(e.length)|0;var r=s(t);for(var n=0;n<t;n+=1){r[n]=e[n]&255}return r}function c(e,t,r){if(t<0||e.byteLength<t){throw new RangeError('"offset" is outside of buffer bounds')}if(e.byteLength<t+(r||0)){throw new RangeError('"length" is outside of buffer bounds')}var n;if(t===undefined&&r===undefined){n=new Uint8Array(e)}else if(r===undefined){n=new Uint8Array(e,t)}else{n=new Uint8Array(e,t,r)}n.__proto__=p.prototype;return n}function g(e){if(p.isBuffer(e)){var t=y(e.length)|0;var r=s(t);if(r.length===0){return r}e.copy(r,0,0,t);return r}if(e.length!==undefined){if(typeof e.length!=="number"||O(e.length)){return s(0)}return u(e)}if(e.type==="Buffer"&&Array.isArray(e.data)){return u(e.data)}}function y(e){if(e>=r){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+r.toString(16)+" bytes")}return e|0}function t(e){if(+e!=e){e=0}return p.alloc(+e)}p.isBuffer=function e(t){return t!=null&&t._isBuffer===true&&t!==p.prototype};p.compare=function e(t,r){if(U(t,Uint8Array))t=p.from(t,t.offset,t.byteLength);if(U(r,Uint8Array))r=p.from(r,r.offset,r.byteLength);if(!p.isBuffer(t)||!p.isBuffer(r)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(t===r)return 0;var n=t.length;var i=r.length;for(var a=0,s=Math.min(n,i);a<s;++a){if(t[a]!==r[a]){n=t[a];i=r[a];break}}if(n<i)return-1;if(i<n)return 1;return 0};p.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};p.concat=function e(t,r){if(!Array.isArray(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return p.alloc(0)}var n;if(r===undefined){r=0;for(n=0;n<t.length;++n){r+=t[n].length}}var i=p.allocUnsafe(r);var a=0;for(n=0;n<t.length;++n){var s=t[n];if(U(s,Uint8Array)){s=p.from(s)}if(!p.isBuffer(s)){throw new TypeError('"list" argument must be an Array of Buffers')}s.copy(i,a);a+=s.length}return i};function d(e,t){if(p.isBuffer(e)){return e.length}if(ArrayBuffer.isView(e)||U(e,ArrayBuffer)){return e.byteLength}if(typeof e!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof e)}var r=e.length;var n=arguments.length>2&&arguments[2]===true;if(!n&&r===0)return 0;var i=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return _(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return T(e).length;default:if(i){return n?-1:_(e).length}t=(""+t).toLowerCase();i=true}}}p.byteLength=d;function m(e,t,r){var n=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(r===undefined||r>this.length){r=this.length}if(r<=0){return""}r>>>=0;t>>>=0;if(r<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return k(this,t,r);case"utf8":case"utf-8":return B(this,t,r);case"ascii":return F(this,t,r);case"latin1":case"binary":return N(this,t,r);case"base64":return X(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();n=true}}}p.prototype._isBuffer=true;function b(e,t,r){var n=e[t];e[t]=e[r];e[r]=n}p.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var r=0;r<t;r+=2){b(this,r,r+1)}return this};p.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var r=0;r<t;r+=4){b(this,r,r+3);b(this,r+1,r+2)}return this};p.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var r=0;r<t;r+=8){b(this,r,r+7);b(this,r+1,r+6);b(this,r+2,r+5);b(this,r+3,r+4)}return this};p.prototype.toString=function e(){var t=this.length;if(t===0)return"";if(arguments.length===0)return B(this,0,t);return m.apply(this,arguments)};p.prototype.toLocaleString=p.prototype.toString;p.prototype.equals=function e(t){if(!p.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return p.compare(this,t)===0};p.prototype.inspect=function e(){var t="";var r=K.INSPECT_MAX_BYTES;t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim();if(this.length>r)t+=" ... ";return"<Buffer "+t+">"};p.prototype.compare=function e(t,r,n,i,a){if(U(t,Uint8Array)){t=p.from(t,t.offset,t.byteLength)}if(!p.isBuffer(t)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof t)}if(r===undefined){r=0}if(n===undefined){n=t?t.length:0}if(i===undefined){i=0}if(a===undefined){a=this.length}if(r<0||n>t.length||i<0||a>this.length){throw new RangeError("out of range index")}if(i>=a&&r>=n){return 0}if(i>=a){return-1}if(r>=n){return 1}r>>>=0;n>>>=0;i>>>=0;a>>>=0;if(this===t)return 0;var s=a-i;var o=n-r;var h=Math.min(s,o);var f=this.slice(i,a);var l=t.slice(r,n);for(var u=0;u<h;++u){if(f[u]!==l[u]){s=f[u];o=l[u];break}}if(s<o)return-1;if(o<s)return 1;return 0};function w(e,t,r,n,i){if(e.length===0)return-1;if(typeof r==="string"){n=r;r=0}else if(r>2147483647){r=2147483647}else if(r<-2147483648){r=-2147483648}r=+r;if(O(r)){r=i?0:e.length-1}if(r<0)r=e.length+r;if(r>=e.length){if(i)return-1;else r=e.length-1}else if(r<0){if(i)r=0;else return-1}if(typeof t==="string"){t=p.from(t,n)}if(p.isBuffer(t)){if(t.length===0){return-1}return v(e,t,r,n,i)}else if(typeof t==="number"){t=t&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(i){return Uint8Array.prototype.indexOf.call(e,t,r)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,r)}}return v(e,[t],r,n,i)}throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var a=1;var s=e.length;var o=t.length;if(n!==undefined){n=String(n).toLowerCase();if(n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le"){if(e.length<2||t.length<2){return-1}a=2;s/=2;o/=2;r/=2}}function h(e,t){if(a===1){return e[t]}else{return e.readUInt16BE(t*a)}}var f;if(i){var l=-1;for(f=r;f<s;f++){if(h(e,f)===h(t,l===-1?0:f-l)){if(l===-1)l=f;if(f-l+1===o)return l*a}else{if(l!==-1)f-=f-l;l=-1}}}else{if(r+o>s)r=s-o;for(f=r;f>=0;f--){var u=true;for(var p=0;p<o;p++){if(h(e,f+p)!==h(t,p)){u=false;break}}if(u)return f}}return-1}p.prototype.includes=function e(t,r,n){return this.indexOf(t,r,n)!==-1};p.prototype.indexOf=function e(t,r,n){return w(this,t,r,n,true)};p.prototype.lastIndexOf=function e(t,r,n){return w(this,t,r,n,false)};function x(e,t,r,n){r=Number(r)||0;var i=e.length-r;if(!n){n=i}else{n=Number(n);if(n>i){n=i}}var a=t.length;if(n>a/2){n=a/2}for(var s=0;s<n;++s){var o=parseInt(t.substr(s*2,2),16);if(O(o))return s;e[r+s]=o}return s}function A(e,t,r,n){return L(_(t,e.length-r),e,r,n)}function C(e,t,r,n){return L(V(t),e,r,n)}function j(e,t,r,n){return C(e,t,r,n)}function Y(e,t,r,n){return L(T(t),e,r,n)}function S(e,t,r,n){return L(J(t,e.length-r),e,r,n)}p.prototype.write=function e(t,r,n,i){if(r===undefined){i="utf8";n=this.length;r=0}else if(n===undefined&&typeof r==="string"){i=r;n=this.length;r=0}else if(isFinite(r)){r=r>>>0;if(isFinite(n)){n=n>>>0;if(i===undefined)i="utf8"}else{i=n;n=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var a=this.length-r;if(n===undefined||n>a)n=a;if(t.length>0&&(n<0||r<0)||r>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!i)i="utf8";var s=false;for(;;){switch(i){case"hex":return x(this,t,r,n);case"utf8":case"utf-8":return A(this,t,r,n);case"ascii":return C(this,t,r,n);case"latin1":case"binary":return j(this,t,r,n);case"base64":return Y(this,t,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,r,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase();s=true}}};p.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(e,t,r){if(t===0&&r===e.length){return n.fromByteArray(e)}else{return n.fromByteArray(e.slice(t,r))}}function B(e,t,r){r=Math.min(e.length,r);var n=[];var i=t;while(i<r){var a=e[i];var s=null;var o=a>239?4:a>223?3:a>191?2:1;if(i+o<=r){var h,f,l,u;switch(o){case 1:if(a<128){s=a}break;case 2:h=e[i+1];if((h&192)===128){u=(a&31)<<6|h&63;if(u>127){s=u}}break;case 3:h=e[i+1];f=e[i+2];if((h&192)===128&&(f&192)===128){u=(a&15)<<12|(h&63)<<6|f&63;if(u>2047&&(u<55296||u>57343)){s=u}}break;case 4:h=e[i+1];f=e[i+2];l=e[i+3];if((h&192)===128&&(f&192)===128&&(l&192)===128){u=(a&15)<<18|(h&63)<<12|(f&63)<<6|l&63;if(u>65535&&u<1114112){s=u}}}}if(s===null){s=65533;o=1}else if(s>65535){s-=65536;n.push(s>>>10&1023|55296);s=56320|s&1023}n.push(s);i+=o}return G(n)}var D=4096;function G(e){var t=e.length;if(t<=D){return String.fromCharCode.apply(String,e)}var r="";var n=0;while(n<t){r+=String.fromCharCode.apply(String,e.slice(n,n+=D))}return r}function F(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i){n+=String.fromCharCode(e[i]&127)}return n}function N(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i){n+=String.fromCharCode(e[i])}return n}function k(e,t,r){var n=e.length;if(!t||t<0)t=0;if(!r||r<0||r>n)r=n;var i="";for(var a=t;a<r;++a){i+=q(e[a])}return i}function z(e,t,r){var n=e.slice(t,r);var i="";for(var a=0;a<n.length;a+=2){i+=String.fromCharCode(n[a]+n[a+1]*256)}return i}p.prototype.slice=function e(t,r){var n=this.length;t=~~t;r=r===undefined?n:~~r;if(t<0){t+=n;if(t<0)t=0}else if(t>n){t=n}if(r<0){r+=n;if(r<0)r=0}else if(r>n){r=n}if(r<t)r=t;var i=this.subarray(t,r);i.__proto__=p.prototype;return i};function E(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}p.prototype.readUIntLE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)E(t,r,this.length);var i=this[t];var a=1;var s=0;while(++s<r&&(a*=256)){i+=this[t+s]*a}return i};p.prototype.readUIntBE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n){E(t,r,this.length)}var i=this[t+--r];var a=1;while(r>0&&(a*=256)){i+=this[t+--r]*a}return i};p.prototype.readUInt8=function e(t,r){t=t>>>0;if(!r)E(t,1,this.length);return this[t]};p.prototype.readUInt16LE=function e(t,r){t=t>>>0;if(!r)E(t,2,this.length);return this[t]|this[t+1]<<8};p.prototype.readUInt16BE=function e(t,r){t=t>>>0;if(!r)E(t,2,this.length);return this[t]<<8|this[t+1]};p.prototype.readUInt32LE=function e(t,r){t=t>>>0;if(!r)E(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};p.prototype.readUInt32BE=function e(t,r){t=t>>>0;if(!r)E(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};p.prototype.readIntLE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)E(t,r,this.length);var i=this[t];var a=1;var s=0;while(++s<r&&(a*=256)){i+=this[t+s]*a}a*=128;if(i>=a)i-=Math.pow(2,8*r);return i};p.prototype.readIntBE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)E(t,r,this.length);var i=r;var a=1;var s=this[t+--i];while(i>0&&(a*=256)){s+=this[t+--i]*a}a*=128;if(s>=a)s-=Math.pow(2,8*r);return s};p.prototype.readInt8=function e(t,r){t=t>>>0;if(!r)E(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};p.prototype.readInt16LE=function e(t,r){t=t>>>0;if(!r)E(t,2,this.length);var n=this[t]|this[t+1]<<8;return n&32768?n|4294901760:n};p.prototype.readInt16BE=function e(t,r){t=t>>>0;if(!r)E(t,2,this.length);var n=this[t+1]|this[t]<<8;return n&32768?n|4294901760:n};p.prototype.readInt32LE=function e(t,r){t=t>>>0;if(!r)E(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};p.prototype.readInt32BE=function e(t,r){t=t>>>0;if(!r)E(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};p.prototype.readFloatLE=function e(t,r){t=t>>>0;if(!r)E(t,4,this.length);return a.read(this,t,true,23,4)};p.prototype.readFloatBE=function e(t,r){t=t>>>0;if(!r)E(t,4,this.length);return a.read(this,t,false,23,4)};p.prototype.readDoubleLE=function e(t,r){t=t>>>0;if(!r)E(t,8,this.length);return a.read(this,t,true,52,8)};p.prototype.readDoubleBE=function e(t,r){t=t>>>0;if(!r)E(t,8,this.length);return a.read(this,t,false,52,8)};function I(e,t,r,n,i,a){if(!p.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}p.prototype.writeUIntLE=function e(t,r,n,i){t=+t;r=r>>>0;n=n>>>0;if(!i){var a=Math.pow(2,8*n)-1;I(this,t,r,n,a,0)}var s=1;var o=0;this[r]=t&255;while(++o<n&&(s*=256)){this[r+o]=t/s&255}return r+n};p.prototype.writeUIntBE=function e(t,r,n,i){t=+t;r=r>>>0;n=n>>>0;if(!i){var a=Math.pow(2,8*n)-1;I(this,t,r,n,a,0)}var s=n-1;var o=1;this[r+s]=t&255;while(--s>=0&&(o*=256)){this[r+s]=t/o&255}return r+n};p.prototype.writeUInt8=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,1,255,0);this[r]=t&255;return r+1};p.prototype.writeUInt16LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,2,65535,0);this[r]=t&255;this[r+1]=t>>>8;return r+2};p.prototype.writeUInt16BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,2,65535,0);this[r]=t>>>8;this[r+1]=t&255;return r+2};p.prototype.writeUInt32LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,4,4294967295,0);this[r+3]=t>>>24;this[r+2]=t>>>16;this[r+1]=t>>>8;this[r]=t&255;return r+4};p.prototype.writeUInt32BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,4,4294967295,0);this[r]=t>>>24;this[r+1]=t>>>16;this[r+2]=t>>>8;this[r+3]=t&255;return r+4};p.prototype.writeIntLE=function e(t,r,n,i){t=+t;r=r>>>0;if(!i){var a=Math.pow(2,8*n-1);I(this,t,r,n,a-1,-a)}var s=0;var o=1;var h=0;this[r]=t&255;while(++s<n&&(o*=256)){if(t<0&&h===0&&this[r+s-1]!==0){h=1}this[r+s]=(t/o>>0)-h&255}return r+n};p.prototype.writeIntBE=function e(t,r,n,i){t=+t;r=r>>>0;if(!i){var a=Math.pow(2,8*n-1);I(this,t,r,n,a-1,-a)}var s=n-1;var o=1;var h=0;this[r+s]=t&255;while(--s>=0&&(o*=256)){if(t<0&&h===0&&this[r+s+1]!==0){h=1}this[r+s]=(t/o>>0)-h&255}return r+n};p.prototype.writeInt8=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,1,127,-128);if(t<0)t=255+t+1;this[r]=t&255;return r+1};p.prototype.writeInt16LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,2,32767,-32768);this[r]=t&255;this[r+1]=t>>>8;return r+2};p.prototype.writeInt16BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,2,32767,-32768);this[r]=t>>>8;this[r+1]=t&255;return r+2};p.prototype.writeInt32LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,4,2147483647,-2147483648);this[r]=t&255;this[r+1]=t>>>8;this[r+2]=t>>>16;this[r+3]=t>>>24;return r+4};p.prototype.writeInt32BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)I(this,t,r,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;this[r]=t>>>24;this[r+1]=t>>>16;this[r+2]=t>>>8;this[r+3]=t&255;return r+4};function P(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,i){t=+t;r=r>>>0;if(!i){P(e,t,r,4,34028234663852886e22,-34028234663852886e22)}a.write(e,t,r,n,23,4);return r+4}p.prototype.writeFloatLE=function e(t,r,n){return M(this,t,r,true,n)};p.prototype.writeFloatBE=function e(t,r,n){return M(this,t,r,false,n)};function R(e,t,r,n,i){t=+t;r=r>>>0;if(!i){P(e,t,r,8,17976931348623157e292,-17976931348623157e292)}a.write(e,t,r,n,52,8);return r+8}p.prototype.writeDoubleLE=function e(t,r,n){return R(this,t,r,true,n)};p.prototype.writeDoubleBE=function e(t,r,n){return R(this,t,r,false,n)};p.prototype.copy=function e(t,r,n,i){if(!p.isBuffer(t))throw new TypeError("argument should be a Buffer");if(!n)n=0;if(!i&&i!==0)i=this.length;if(r>=t.length)r=t.length;if(!r)r=0;if(i>0&&i<n)i=n;if(i===n)return 0;if(t.length===0||this.length===0)return 0;if(r<0){throw new RangeError("targetStart out of bounds")}if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");if(i>this.length)i=this.length;if(t.length-r<i-n){i=t.length-r+n}var a=i-n;if(this===t&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(r,n,i)}else if(this===t&&n<r&&r<i){for(var s=a-1;s>=0;--s){t[s+r]=this[s+n]}}else{Uint8Array.prototype.set.call(t,this.subarray(n,i),r)}return a};p.prototype.fill=function e(t,r,n,i){if(typeof t==="string"){if(typeof r==="string"){i=r;r=0;n=this.length}else if(typeof n==="string"){i=n;n=this.length}if(i!==undefined&&typeof i!=="string"){throw new TypeError("encoding must be a string")}if(typeof i==="string"&&!p.isEncoding(i)){throw new TypeError("Unknown encoding: "+i)}if(t.length===1){var a=t.charCodeAt(0);if(i==="utf8"&&a<128||i==="latin1"){t=a}}}else if(typeof t==="number"){t=t&255}if(r<0||this.length<r||this.length<n){throw new RangeError("Out of range index")}if(n<=r){return this}r=r>>>0;n=n===undefined?this.length:n>>>0;if(!t)t=0;var s;if(typeof t==="number"){for(s=r;s<n;++s){this[s]=t}}else{var o=p.isBuffer(t)?t:p.from(t,i);var h=o.length;if(h===0){throw new TypeError('The value "'+t+'" is invalid for argument "value"')}for(s=0;s<n-r;++s){this[s+r]=o[s%h]}}return this};var H=/[^+/0-9A-Za-z-_]/g;function W(e){e=e.split("=")[0];e=e.trim().replace(H,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function q(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function _(e,t){t=t||Infinity;var r;var n=e.length;var i=null;var a=[];for(var s=0;s<n;++s){r=e.charCodeAt(s);if(r>55295&&r<57344){if(!i){if(r>56319){if((t-=3)>-1)a.push(239,191,189);continue}else if(s+1===n){if((t-=3)>-1)a.push(239,191,189);continue}i=r;continue}if(r<56320){if((t-=3)>-1)a.push(239,191,189);i=r;continue}r=(i-55296<<10|r-56320)+65536}else if(i){if((t-=3)>-1)a.push(239,191,189)}i=null;if(r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else{throw new Error("Invalid code point")}}return a}function V(e){var t=[];for(var r=0;r<e.length;++r){t.push(e.charCodeAt(r)&255)}return t}function J(e,t){var r,n,i;var a=[];for(var s=0;s<e.length;++s){if((t-=2)<0)break;r=e.charCodeAt(s);n=r>>8;i=r%256;a.push(i);a.push(n)}return a}function T(e){return n.toByteArray(W(e))}function L(e,t,r,n){for(var i=0;i<n;++i){if(i+r>=t.length||i>=e.length)break;t[i+r]=e[i]}return i}function U(e,t){return e instanceof t||e!=null&&e.constructor!=null&&e.constructor.name!=null&&e.constructor.name===t.name}function O(e){return e!==e}}).call(this)}).call(this,Z("buffer").Buffer)},{"base64-js":12,buffer:13,ieee754:14}],14:[function(e,t,r){r.read=function(e,t,r,n,i){var a,s;var o=i*8-n-1;var h=(1<<o)-1;var f=h>>1;var l=-7;var u=r?i-1:0;var p=r?-1:1;var c=e[t+u];u+=p;a=c&(1<<-l)-1;c>>=-l;l+=o;for(;l>0;a=a*256+e[t+u],u+=p,l-=8){}s=a&(1<<-l)-1;a>>=-l;l+=n;for(;l>0;s=s*256+e[t+u],u+=p,l-=8){}if(a===0){a=1-f}else if(a===h){return s?NaN:(c?-1:1)*Infinity}else{s=s+Math.pow(2,n);a=a-f}return(c?-1:1)*s*Math.pow(2,a-n)};r.write=function(e,t,r,n,i,a){var s,o,h;var f=a*8-i-1;var l=(1<<f)-1;var u=l>>1;var p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0;var c=n?0:a-1;var g=n?1:-1;var y=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){o=isNaN(t)?1:0;s=l}else{s=Math.floor(Math.log(t)/Math.LN2);if(t*(h=Math.pow(2,-s))<1){s--;h*=2}if(s+u>=1){t+=p/h}else{t+=p*Math.pow(2,1-u)}if(t*h>=2){s++;h/=2}if(s+u>=l){o=0;s=l}else if(s+u>=1){o=(t*h-1)*Math.pow(2,i);s=s+u}else{o=t*Math.pow(2,u-1)*Math.pow(2,i);s=0}}for(;i>=8;e[r+c]=o&255,c+=g,o/=256,i-=8){}s=s<<i|o;f+=i;for(;f>0;e[r+c]=s&255,c+=g,s/=256,f-=8){}e[r+c-g]|=y*128}},{}]},{},[11])(11)});